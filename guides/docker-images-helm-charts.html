<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kargo</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kargo/kargo-icon-64x64.png">
    <link rel="manifest" href="/kargo/manifest.json">
    <meta name="description" content="A Docker based solution to deploy Geospatial Services">
    
    <link rel="preload" href="/kargo/assets/css/0.styles.21f892e9.css" as="style"><link rel="preload" href="/kargo/assets/js/app.ae0a8ea4.js" as="script"><link rel="preload" href="/kargo/assets/js/3.2a46a756.js" as="script"><link rel="preload" href="/kargo/assets/js/19.a48e50fa.js" as="script"><link rel="preload" href="/kargo/assets/js/4.1b74af09.js" as="script"><link rel="prefetch" href="/kargo/assets/js/10.5242a69b.js"><link rel="prefetch" href="/kargo/assets/js/11.629febd6.js"><link rel="prefetch" href="/kargo/assets/js/12.32088f54.js"><link rel="prefetch" href="/kargo/assets/js/13.7bfc96da.js"><link rel="prefetch" href="/kargo/assets/js/14.fef6b623.js"><link rel="prefetch" href="/kargo/assets/js/15.8f6428ca.js"><link rel="prefetch" href="/kargo/assets/js/16.c407c2f1.js"><link rel="prefetch" href="/kargo/assets/js/17.ff63ab84.js"><link rel="prefetch" href="/kargo/assets/js/18.d5f0e9d8.js"><link rel="prefetch" href="/kargo/assets/js/2.aadf217f.js"><link rel="prefetch" href="/kargo/assets/js/20.052a1270.js"><link rel="prefetch" href="/kargo/assets/js/21.08d1714b.js"><link rel="prefetch" href="/kargo/assets/js/22.266c3b88.js"><link rel="prefetch" href="/kargo/assets/js/23.d885bd2b.js"><link rel="prefetch" href="/kargo/assets/js/24.3952441e.js"><link rel="prefetch" href="/kargo/assets/js/25.c8c15d63.js"><link rel="prefetch" href="/kargo/assets/js/26.c9f07b37.js"><link rel="prefetch" href="/kargo/assets/js/27.35d3b59c.js"><link rel="prefetch" href="/kargo/assets/js/28.9b96dd73.js"><link rel="prefetch" href="/kargo/assets/js/29.23749e29.js"><link rel="prefetch" href="/kargo/assets/js/30.117c6bd4.js"><link rel="prefetch" href="/kargo/assets/js/31.f3e3d35a.js"><link rel="prefetch" href="/kargo/assets/js/32.d4caaded.js"><link rel="prefetch" href="/kargo/assets/js/33.cef21e18.js"><link rel="prefetch" href="/kargo/assets/js/34.5bae7d60.js"><link rel="prefetch" href="/kargo/assets/js/35.cd896010.js"><link rel="prefetch" href="/kargo/assets/js/5.b4fe35da.js"><link rel="prefetch" href="/kargo/assets/js/6.ef3c43be.js"><link rel="prefetch" href="/kargo/assets/js/7.24c688a2.js"><link rel="prefetch" href="/kargo/assets/js/8.92991761.js"><link rel="prefetch" href="/kargo/assets/js/9.1eff0c26.js">
    <link rel="stylesheet" href="/kargo/assets/css/0.styles.21f892e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kargo/" class="home-link router-link-active"><!----> <span class="site-name">Kargo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kargo/tips/using-gdal.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kargo/tips/using-gdal.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/kargo/guides/understanding-kargo.html" class="sidebar-link">Understanding Kargo</a></li><li><a href="/kargo/guides/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/kargo/guides/advanced-usage.html" class="sidebar-link">Advanced usage</a></li><li><a href="/kargo/guides/infrastructure-management.html" class="sidebar-link">Infrastructure management</a></li><li><a href="/kargo/guides/docker-images-helm-charts.html" aria-current="page" class="active sidebar-link">/guides/docker-images-helm-charts.html</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>We run docker images through kubernetes, which mean we have some helm chart</p> <h1 id="docker-image-best-practices"><a href="#docker-image-best-practices" class="header-anchor">#</a> Docker image best practices</h1> <ul><li>Prefer -slim images as base and use multi stage builds to reduce image sizes</li> <li>Make your docker image run as unpriviliged user
<ul><li>If it's node based, and using a node image as base, there's a 'node' user (uid 1000) already available
<ul><li>Copy app's files using COPY --chown node</li> <li>Make your command run as 'node' user</li></ul></li> <li>If there's no preinstalled user, create one and use it</li></ul></li> <li>Since it'll run as unpriviliged user, if you need to open ports, make sure they're &gt;= 1024</li></ul> <p>RUN <br>
DEBIAN_FRONTEND=noninteractive &amp;&amp; <br>
apt-get update &amp;&amp; <br>
apt-get --no-install-recommends --yes install <br>
openjdk-11-jre-headless <br>
ca-certificates <br>
gdal-bin &amp;&amp; <br>
apt-get clean &amp;&amp; <br>
rm -rf /var/lib/apt/lists/*</p> <p>RUN <br>
yarn global add @weacast/grib2json@${GRIB2JSON_TAG} &amp;&amp; <br>
chmod a+x /usr/local/share/.config/yarn/global/node_modules/@weacast/grib2json/bin/grib2json &amp;&amp; <br>
yarn cache clean</p> <h1 id="helm-charts-best-practices"><a href="#helm-charts-best-practices" class="header-anchor">#</a> Helm charts best practices</h1> <ul><li>Define appVersion to the docker image tag it's supposed to pull (no latest in defined charts, latest can be specified using values.yaml in infra definition)</li> <li>Include configurable resource requests &amp; limits</li> <li>Include configurable security context and put sensible defaults in chart's values.yaml</li> <li>If it's being deployed on some preprod infra, then chart version should be at least 1.0.0</li></ul> <h1 id="infrastructure-management-best-practices"><a href="#infrastructure-management-best-practices" class="header-anchor">#</a> Infrastructure management best practices</h1> <ul><li>Local charts must not depend on 0.0.0-dev charts when infra is != from staging/dev</li></ul> <h1 id="howto-version-docker-images"><a href="#howto-version-docker-images" class="header-anchor">#</a> Howto version docker images</h1> <ul><li>kargo specific container images (tileservergl &amp; friends ...)
<ul><li>[build app-name tag]</li></ul></li> <li>kapture yarn release:[major,minor,patch]</li> <li>k-hubeau-* yarn release:[major,minor,patch]</li></ul> <h1 id="howto-version-helm-charts"><a href="#howto-version-helm-charts" class="header-anchor">#</a> Howto version helm charts</h1> <ul><li>[pack] in commit message =&gt; will regenerate all 0.0.0-dev charts</li> <li>yarn release:charts:[major,minor,patch] =&gt; will make a new tagged release
<ul><li>if given a glob patten, will only release matching charts</li></ul></li></ul> <h1 id="known-issues"><a href="#known-issues" class="header-anchor">#</a> Known issues</h1> <h1 id="open-issues"><a href="#open-issues" class="header-anchor">#</a> Open issues</h1> <ul><li>would be nice to forbid pushing over a tag that already exists (container, chart), except latest
<ul><li>if needed, remove tag from dockerhub, harbor, whatever and then push</li></ul></li> <li>would be nice for charts if touching version makes a release</li> <li>document per project how to release</li> <li>what if ci fails and is triggered using commit message ?</li> <li>what if ci fails and is triggered using version bump in package.json ?</li> <li>is it possible to pack a chart using version-SNAPSHOT or something ?</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kargo/guides/infrastructure-management.html" class="prev">
        Infrastructure management
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/kargo/assets/js/app.ae0a8ea4.js" defer></script><script src="/kargo/assets/js/3.2a46a756.js" defer></script><script src="/kargo/assets/js/19.a48e50fa.js" defer></script><script src="/kargo/assets/js/4.1b74af09.js" defer></script>
  </body>
</html>
