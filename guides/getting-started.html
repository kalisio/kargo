<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started | Kargo</title>
    <meta name="description" content="A Docker based solution to deploy Geospatial Services">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kargo/kargo-icon-64x64.png">
  <link rel="manifest" href="/kargo/manifest.json">
    
    <link rel="preload" href="/kargo/assets/css/0.styles.f99ae279.css" as="style"><link rel="preload" href="/kargo/assets/js/app.3f2a7a13.js" as="script"><link rel="preload" href="/kargo/assets/js/4.a3da8878.js" as="script"><link rel="prefetch" href="/kargo/assets/js/10.3dfa161c.js"><link rel="prefetch" href="/kargo/assets/js/11.a2363c00.js"><link rel="prefetch" href="/kargo/assets/js/12.3209934c.js"><link rel="prefetch" href="/kargo/assets/js/13.e24b53ca.js"><link rel="prefetch" href="/kargo/assets/js/14.974629db.js"><link rel="prefetch" href="/kargo/assets/js/15.9fd181c3.js"><link rel="prefetch" href="/kargo/assets/js/16.565e71a4.js"><link rel="prefetch" href="/kargo/assets/js/17.7184b84e.js"><link rel="prefetch" href="/kargo/assets/js/18.71b3d83a.js"><link rel="prefetch" href="/kargo/assets/js/2.24baac52.js"><link rel="prefetch" href="/kargo/assets/js/3.8ae1ec53.js"><link rel="prefetch" href="/kargo/assets/js/5.c5fb63f0.js"><link rel="prefetch" href="/kargo/assets/js/6.04422ecb.js"><link rel="prefetch" href="/kargo/assets/js/7.17f520d9.js"><link rel="prefetch" href="/kargo/assets/js/8.12625ac8.js"><link rel="prefetch" href="/kargo/assets/js/9.a5b12833.js">
    <link rel="stylesheet" href="/kargo/assets/css/0.styles.f99ae279.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kargo/" class="home-link router-link-active"><!----> <span class="site-name">Kargo</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kargo/tips/using-kargo-toolbox.html" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kargo/tips/using-kargo-toolbox.html" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><a href="/kargo/guides/understanding-kargo.html" class="sidebar-link">Understanding Kargo</a></li><li><a href="/kargo/guides/getting-started.html" class="active sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kargo/guides/getting-started.html#prepare-the-infrastructure" class="sidebar-link">Prepare the infrastructure</a></li><li class="sidebar-sub-header"><a href="/kargo/guides/getting-started.html#setup-the-services" class="sidebar-link">Setup the services</a></li><li class="sidebar-sub-header"><a href="/kargo/guides/getting-started.html#manage-the-services" class="sidebar-link">Manage the services</a></li></ul></li><li><a href="/kargo/guides/advanced-usage.html" class="sidebar-link">Advanced usage</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="getting-started"><a href="#getting-started" aria-hidden="true" class="header-anchor">#</a> Getting Started</h1> <p>Using <strong>kargo</strong> is quite easy and basically the approach to setup your Geospatial platform is the following:</p> <ul><li><a href="#prepare-the-infrastructure">Prepare the infrastructure</a></li> <li><a href="#setup-the-services">Setup the services</a></li> <li><a href="#manage-the-services">Manage the services</a></li></ul> <p>In the following guides, we will explain how to deploy a complete set of services on a given infrastructure such as illustrated in this diagram:</p> <p><img src="/kargo/assets/img/kargo-example-assumptions.0161491c.svg" alt="kargo-example-assumptions"></p> <p>Thus, we assume you already have a running Swarm infrastructure with:</p> <ul><li>A manager node</li> <li>Multiple worker nodes with sufficient disk space to store the data</li></ul> <p>Check your infrastructure using the command <code>docker node ls</code>, you should have a response similar to:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> node <span class="token function">ls</span>
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
jqtuxajexk18ypiylk6i6dv0q     worker-0            Ready               Active                                  18.03.1-ce
x6tc2sqi99vp106icwf2nmyp0 *   manager             Ready               Active              Leader              18.03.1-ce
wfr5hwhfd5413p2ql9hwitbkw     worker-1            Ready               Active                                  18.03.1-ce
8980x3d76x1r7kxoa7h5lzob8     worker-2            Ready               Active                                  18.03.1-ce
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">Prerequisites</p> <p>If you do not have such an infrastructure, you may have a look at <a href="https://kalisio.github.io/kaabah/" target="_blank" rel="noopener noreferrer"><strong>Kaabah</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <h2 id="prepare-the-infrastructure"><a href="#prepare-the-infrastructure" aria-hidden="true" class="header-anchor">#</a> Prepare the infrastructure</h2> <h3 id="install-the-prerequisites"><a href="#install-the-prerequisites" aria-hidden="true" class="header-anchor">#</a> Install the prerequisites</h3> <h4 id="install-a-local-registry"><a href="#install-a-local-registry" aria-hidden="true" class="header-anchor">#</a> Install a local Registry</h4> <p>Some of the services proposed by <strong>Kargo</strong> need to be built before you can deploy it. For this reason, it is necessary to have a local Registry on the Manager node to store the images.</p> <p>To install it you can run the command <code>docker stack deploy -c registry.yml registry</code> where the Compose file <code>registry.yml</code> has the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>version: '3.5'

services:
  registry:
    image: registry:2
    ports:
      - 5000:5000
    networks:
      - swarm-network
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager

networks:
  swarm-network:
    name: &lt;swarm network&gt;
    external: true
</code></pre></div><h4 id="install-sshfs"><a href="#install-sshfs" aria-hidden="true" class="header-anchor">#</a> Install SSHFS</h4> <p>As we will see later, <strong>SSHFS</strong> is used to share the <strong>Kargo</strong> configuration among the nodes. You need to install <strong>SSHFS</strong> on each worker.
To install <strong>SSHFS</strong> you may run the following procedure:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> sshfs
<span class="token comment"># Edit fuse conf to enable the allow_other option</span>
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/fuse.conf and uncomment the line
<span class="token comment">#user_allow_other</span>
</code></pre></div><h3 id="install-kargo"><a href="#install-kargo" aria-hidden="true" class="header-anchor">#</a> Install kargo</h3> <ol><li>Clone the <strong>Kargo</strong> repository</li></ol> <p>On the manager node, clone the repository in your home directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$git</span> clone https://github.com/kalisio/kargo.git
</code></pre></div><ol start="2"><li>Share the <strong>Kargo</strong> configuration with the workers.</li></ol> <p>On each worker, use <code>sshfs</code> to share the <code>configs</code> directory. The path to the shared directory must be the same on the workers as on the manager.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /home/ubuntu/kargo/.kargo/configs
sshfs ubuntu@<span class="token operator">&lt;</span>swam manager ip<span class="token operator">&gt;</span>:/home/ubuntu/kargo/.kargo/configs /home/ubuntu/kargo/.kargo/configs -o IdentityFile<span class="token operator">=</span>/home/ubuntu/.ssh/ssh.pem -o allow_other
</code></pre></div><p>To ensure the volume is permanently mounted (even on reboot), you should prefer to:</p> <ol><li>add the following line to your <code>/etc/fstab</code> file:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>sshfs#ubuntu@&lt;manager_ip&gt;:/home/ubuntu/kargo/.kargo/configs /home/ubuntu/kargo/.kargo/configs fuse auto,_netdev,port=22,user,allow_other,IdentityFile=/home/ubuntu.ssh/ssh.pem,reconnect 0 0
</code></pre></div><ol start="2"><li>mount the volume using the command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$sudo</span> <span class="token function">mount</span> -a
</code></pre></div><h3 id="provision-the-data"><a href="#provision-the-data" aria-hidden="true" class="header-anchor">#</a> Provision the data</h3> <p>It is up to you to copy your data to the different nodes. You must have to keep in mind that these data will have to be accessible by the services that you want to deploy.</p> <div class="tip custom-block"><p class="custom-block-title">Looking for data ?</p> <p>We can provide datasets from different sources such as public catalogs and those of our partners such as <a href="https://openmaptiles.com/" target="_blank" rel="noopener noreferrer">OpenMapTiles<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.planetobserver.com/" target="_blank" rel="noopener noreferrer">PlanetObserver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Do bot hesitate to contact us at contact@kalisio.com.</p></div> <h3 id="define-node-constraints"><a href="#define-node-constraints" aria-hidden="true" class="header-anchor">#</a> Define node constraints</h3> <p>Once you have copy the datasets to the different nodes, you need to add some labels to the nodes that can be used to specify constraints when deploying the services.</p> <p>In our case, we need to add the following labels:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># On worker-0</span>
<span class="token variable">$docker</span> node update --label-add tileservergl<span class="token operator">=</span>true jqtuxajexk18ypiylk6i6dv0q
<span class="token comment"># On worker-1 </span>
<span class="token variable">$docker</span> node update --label-add weacast<span class="token operator">=</span>true wfr5hwhfd5413p2ql9hwitbkw
<span class="token comment"># On worker-2</span>
<span class="token variable">$docker</span> node update --label-add mongodb<span class="token operator">=</span>true 8980x3d76x1r7kxoa7h5lzob8
<span class="token variable">$docker</span> node update --label-add postgis<span class="token operator">=</span>true 8980x3d76x1r7kxoa7h5lzob8
</code></pre></div><p>Check your node labels mapping:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> node <span class="token function">ls</span> -q <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">sudo</span> docker node inspect -f <span class="token string">'{{ .ID }} [{{ .Description.Hostname }}]: {{ .Spec.Labels }}'</span>
jqtuxajexk18ypiylk6i6dv0q <span class="token punctuation">[</span>worker-0<span class="token punctuation">]</span>: map<span class="token punctuation">[</span>tileservergl:true<span class="token punctuation">]</span>
x6tc2sqi99vp106icwf2nmyp0 <span class="token punctuation">[</span>manager<span class="token punctuation">]</span>: map<span class="token punctuation">[</span><span class="token punctuation">]</span>
wfr5hwhfd5413p2ql9hwitbkw <span class="token punctuation">[</span>worker-1<span class="token punctuation">]</span>: map<span class="token punctuation">[</span>weacast:true<span class="token punctuation">]</span>
8980x3d76x1r7kxoa7h5lzob8 <span class="token punctuation">[</span>worker-2<span class="token punctuation">]</span>: map<span class="token punctuation">[</span>mongodb:true postgis:true<span class="token punctuation">]</span>
</code></pre></div><h2 id="setup-the-services"><a href="#setup-the-services" aria-hidden="true" class="header-anchor">#</a> Setup the services</h2> <h3 id="setup-your-workspace"><a href="#setup-your-workspace" aria-hidden="true" class="header-anchor">#</a> Setup your workspace</h3> <ol><li><p>Create a directory to store your configuration stuff. Give it the name of your choice.</p></li> <li><p>Create the <strong>Environment</strong> file by making a copy of the <code>.env.sample</code> file into your configuration. Rename it as <code>.env</code></p></li> <li><p>Edit the <code>.env</code> file and configure the services you want to deploy. See the section <a href="./reference/environment">Environment</a> to have the complete reference of the services settings.</p></li> <li><p>Define the stacks you want to deploy:</p> <ol><li>Define the <code>STACKS</code> variable listing the stacks</li> <li>For each stacks, define a variable <code>&lt;NAME&gt;_STACK</code> listing the services to deploy</li></ol></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>STACKS<span class="token operator">=</span><span class="token string">&quot;dbs weacast vigicrues jobs apps&quot;</span>
APPS_STACK<span class="token operator">=</span><span class="token string">&quot;tileservergl mapproxy maputnik thredds kano&quot;</span>
DBS_STACK<span class="token operator">=</span><span class="token string">&quot;mongodb&quot;</span>
WEACAST_STACK<span class="token operator">=</span><span class="token string">&quot;arpege-world-loader arpege-europe-loader arome-france-loader gfs-world-loader weacast&quot;</span>
VIGICRUES_STACK<span class="token operator">=</span><span class="token string">&quot;vigicrues-stations vigicrues-observations vigicrues-sections&quot;</span>
JOBS_STACK<span class="token operator">=</span><span class="token string">&quot;teleray&quot;</span>
</code></pre></div><h3 id="generate-the-merged-configuration"><a href="#generate-the-merged-configuration" aria-hidden="true" class="header-anchor">#</a> Generate the merged configuration</h3> <p>Since <strong>Kargo</strong> allows you to override the default configuration with your workspace configuration, it is required to generate the merged configuration before deploying the services. Run the command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$./make-kargo.sh <span class="token operator">&lt;</span>path to your workspace<span class="token operator">&gt;</span>
</code></pre></div><h3 id="build-the-services"><a href="#build-the-services" aria-hidden="true" class="header-anchor">#</a> Build the services</h3> <p>Some of the services provided By <strong>Kargo</strong> need to be built and pushed to the local registry in order to be able to deploy them.
You simply need to run the command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$./build-service.sh <span class="token operator">&lt;</span>service<span class="token operator">&gt;</span>
</code></pre></div><h2 id="manage-the-services"><a href="#manage-the-services" aria-hidden="true" class="header-anchor">#</a> Manage the services</h2> <h3 id="deploy-the-services"><a href="#deploy-the-services" aria-hidden="true" class="header-anchor">#</a> Deploy the services</h3> <p>You can either deploy a given stack or deploy all the stacks.</p> <ul><li>Deploy a stack</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$./deploy-stack.sh <span class="token operator">&lt;</span>apps<span class="token operator">|</span>dbs<span class="token operator">|</span><span class="token function">jobs</span><span class="token operator">|</span>weacast<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Deploy all the stacks</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$./deploy-kargo.sh
</code></pre></div><h3 id="remove-the-services"><a href="#remove-the-services" aria-hidden="true" class="header-anchor">#</a> Remove the services</h3> <p>You can either remove a given stack or remove all the stacks.</p> <ul><li>Stop a stack</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$./remove-stack.sh <span class="token operator">&lt;</span>apps<span class="token operator">|</span>dbs<span class="token operator">|</span><span class="token function">jobs</span><span class="token operator">|</span>weacast<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Stop all the stacks</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$./remove-kargo.sh
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kargo/guides/understanding-kargo.html" class="prev">
          Understanding Kargo
        </a></span> <span class="next"><a href="/kargo/guides/advanced-usage.html">
          Advanced usage
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/kargo/assets/js/app.3f2a7a13.js" defer></script><script src="/kargo/assets/js/4.a3da8878.js" defer></script>
  </body>
</html>
