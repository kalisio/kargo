(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{388:function(t,a,s){"use strict";s.r(a);var e=s(27),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"using-gdal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-gdal"}},[t._v("#")]),t._v(" Using GDAL")]),t._v(" "),s("p",[s("strong",[t._v("Kargo")]),t._v(" provides a "),s("a",{attrs:{href:"https://www.gdal.org/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GDAL"),s("OutboundLink")],1),t._v(" docker image shipped with a set of additional tools:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.imagemagick.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ImageMagick"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/icetan/sqlitepipe",target:"_blank",rel:"noopener noreferrer"}},[t._v("sqlitepipe"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Th "),s("strong",[t._v("GDAL")]),t._v(" image extends the "),s("a",{attrs:{href:"https://hub.docker.com/r/geographica/gdal2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Geographica GDAL2 image"),s("OutboundLink")],1),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"basic-usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#basic-usage"}},[t._v("#")]),t._v(" Basic usage")]),t._v(" "),s("p",[t._v("Simply run the following command on a given worker node:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" run  -v /path/to/your/data:/data -t -i kalisio/gdal:latest /bin/bash\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cd")]),t._v(" /data\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gdalinfo")]),t._v(" path/to/my/dataset\n")])])]),s("p",[t._v("If you need to access another container you will need to run the GDAL container within the same network. For instance, the following command will allow you to link the GDAL container to an existing "),s("code",[t._v("Postgis")]),t._v(" container in the network "),s("code",[t._v("kargo")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" run --network"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kargo  -v /mnt/data:/data -t -i kalisio/gdal:latest /bin/bash\n")])])]),s("p",[t._v("If you need to use the AWS CLI, you may need to share your credentials:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" run  -v /path/to/your/data:/data /home/ubuntu/.aws:/root/.aws -t -i kalisio/gdal:latest /bin/bash\n")])])]),s("h2",{attrs:{id:"use-cases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use-cases"}},[t._v("#")]),t._v(" Use cases")]),t._v(" "),s("h3",{attrs:{id:"how-to-post-process-an-mbtiles-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-post-process-an-mbtiles-file"}},[t._v("#")]),t._v(" How to post process an MBTiles file ?")]),t._v(" "),s("p",[t._v("The "),s("strong",[t._v("gdal")]),t._v(" image comes with the "),s("a",{attrs:{href:"https://github.com/icetan/sqlitepipe",target:"_blank",rel:"noopener noreferrer"}},[t._v("sqlitepipe"),s("OutboundLink")],1),t._v(" utility that can be used for this purpose. The following example shows how to use "),s("strong",[t._v("sqlitepipe")]),t._v(" and "),s("a",{attrs:{href:"https://www.imagemagick.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ImageMagick"),s("OutboundLink")],1),t._v(" to make white pixels transparent on all of the tiles stored within the MBTiles file.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sqlite3")]),t._v(" my-mbtiles.mbtiles\nsqlite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("UPDATE tiles SET "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tile_data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pipe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tile_data, "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/bin/convert'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-transparent'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'white'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'png:-'")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'png:-'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsqlite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("VACUUM tiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsqlite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".quit\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("According the size of the MBTiles to process you may encounter some memory errors and have such an output: "),s("code",[t._v("Error: database or disk is full")]),t._v("\nYou should tell "),s("strong",[t._v("sqlite")]),t._v(" to use a free disk space to work with the temp files:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("sqlite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pragma temp_store "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsqlite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pragma temp_store_directory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/directory/with/lots/of/space'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("h3",{attrs:{id:"how-to-create-a-tile-index-from-an-s3-mosaic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-create-a-tile-index-from-an-s3-mosaic"}},[t._v("#")]),t._v(" How to create a tile index from an S3 mosaic ?")]),t._v(" "),s("ol",[s("li",[t._v("list the tiles in a file while prefixing the tile path with the driver "),s("code",[t._v("viss3")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$aws")]),t._v(" s3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" s3://"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("bucket"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),t._v("}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/^/\\/vsis3\\/<bucket>\\/<path>\\//'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" tiles.txt\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Create the tile index")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gdaltindex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mosaic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".shp --optfile tiles.txt\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("If you want to serve the mosaic using "),s("strong",[t._v("MapServer")]),t._v(", it is recommended to apply the "),s("code",[t._v("shptree")]),t._v(" command in order\nto optimize the index:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$shptree")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mosaic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".shp\n")])])]),s("p",[t._v("In addition you will probably need to provide some parameters, such as "),s("code",[t._v("wcs_extent")]),t._v(" and "),s("code",[t._v("wcs_resolution")]),t._v(". You can get them by building a "),s("a",{attrs:{href:"https://gdal.org/drivers/raster/vrt.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("VRT"),s("OutboundLink")],1),t._v(":")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gdalbuildvrt")]),t._v(" -input_file_list tiles.txt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mosaic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".vrt\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$gdalinfo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mosaic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".vrt\n")])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);