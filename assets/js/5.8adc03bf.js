(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{358:function(t,s,a){t.exports=a.p+"assets/img/kargo-traefik.21ca1aa0.svg"},359:function(t,s,a){t.exports=a.p+"assets/img/kargo-gateway.293e1ae6.svg"},377:function(t,s,a){"use strict";a.r(s);var e=a(27),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"advanced-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#advanced-usage"}},[t._v("#")]),t._v(" Advanced usage")]),t._v(" "),e("h2",{attrs:{id:"configuring-proxy-settings"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-proxy-settings"}},[t._v("#")]),t._v(" Configuring proxy settings")]),t._v(" "),e("p",[t._v("When you choose an on-premises deployment, it may be necessary to configure "),e("strong",[t._v("Kargo")]),t._v(" to use the corporate proxy server.\nTo use a proxy, you can set the environment variables "),e("code",[t._v("HTTP_PROXY")]),t._v(", "),e("code",[t._v("HTTPS_PROXY")]),t._v(", "),e("code",[t._v("FTP_PROXY")]),t._v(" and "),e("code",[t._v("NO_PROXY")]),t._v(".")]),t._v(" "),e("p",[t._v("Depending on the traffic type, set the required variables in your "),e("code",[t._v(".env")]),t._v(" file:")]),t._v(" "),e("div",{staticClass:"language-env extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('HTTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nHTTPS_PROXY="https://USER:PASSWORD@PROXY_SERVER:PORT"\nFTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nNO_PROXY="localhost"\n')])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("NO_PROXY")]),t._v(" must at least contain the value "),e("code",[t._v("localhost")]),t._v(" to let the Krawler jobs healthcheck work correctly.")])]),t._v(" "),e("h2",{attrs:{id:"routing-the-traffic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#routing-the-traffic"}},[t._v("#")]),t._v(" Routing the traffic")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" relies on "),e("a",{attrs:{href:"https://containo.us/traefik/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik"),e("OutboundLink")],1),t._v(" to manage the incoming requests to the platform. "),e("strong",[t._v("Traefik")]),t._v(" is a reverse proxy and load balancer that help routes the incoming requests to the deployed services (backend) using so called "),e("a",{attrs:{href:"https://docs.traefik.io/v1.7/basics/#frontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("frontends"),e("OutboundLink")],1),t._v(". A frontend consists of a set of rules that determine how incoming requests are forwarded from an entry point to a backend.")]),t._v(" "),e("p",[e("img",{attrs:{src:a(358),alt:"kargo-traefik"}})]),t._v(" "),e("p",[t._v("By default "),e("strong",[t._v("Traefik")]),t._v(" is configured with 2 entry points:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("80")]),t._v(": this port ensures HTTP traffic. It is mainly used to enable "),e("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Let's Encrypt"),e("OutboundLink")],1),t._v(" ACME management. However, the port is redirected to the port "),e("code",[t._v("443")])]),t._v(" "),e("li",[e("code",[t._v("443")]),t._v(": this port ensures HTTPS traffic.")])]),t._v(" "),e("p",[t._v("The services provided by "),e("strong",[t._v("Kargo")]),t._v(" are already configured to be automatically discovered by "),e("strong",[t._v("Traefik")]),t._v(" once deployed. Sometimes you may need to override or extend this configuration. See the section "),e("a",{attrs:{href:"#extending-the-services"}},[t._v("extending the services")]),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" still uses the version "),e("code",[t._v("1.7")]),t._v(" of "),e("strong",[t._v("Traefik")]),t._v(". Check the documentation "),e("a",{attrs:{href:"https://docs.traefik.io/v1.7/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("For security reason, "),e("strong",[t._v("Traefik")]),t._v(" relies on "),e("a",{attrs:{href:"https://github.com/Tecnativa/docker-socket-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-socket-proxy"),e("OutboundLink")],1),t._v(" to secure the access to the Docker socket. Read this "),e("a",{attrs:{href:"https://docs.traefik.io/providers/docker/#docker-api-access",target:"_blank",rel:"noopener noreferrer"}},[t._v("note"),e("OutboundLink")],1),t._v(" to learn more about this security concern.")])]),t._v(" "),e("h2",{attrs:{id:"using-the-api-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-the-api-gateway"}},[t._v("#")]),t._v(" Using the API Gateway")]),t._v(" "),e("p",[t._v("As a reminder, an API gateway allows you to map endpoints to a set of services or applications using url rules. Moreover it is possible to protect those endpoints using various authorization strategies ("),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Key_authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("Key authentication"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON Web Tokens"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://oauth.net/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth"),e("OutboundLink")],1),t._v("...) and defining quotas and rate limiting. To enable such a features "),e("strong",[t._v("Kargo")]),t._v(" relies on "),e("a",{attrs:{href:"https://www.express-gateway.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express gateway"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("We recommend that you read the "),e("strong",[t._v("express gateway")]),t._v(" "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),e("OutboundLink")],1),t._v(" before starting.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[e("strong",[t._v("express gateway")]),t._v(" relies on "),e("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),e("OutboundLink")],1),t._v(" to store the consumers data. In order to check your configuration, "),e("a",{attrs:{href:"https://joeferner.github.io/redis-commander/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Commander"),e("OutboundLink")],1),t._v(" is a convenient solution to explore the "),e("strong",[t._v("Redis")]),t._v(" data store. These 2 applications are easily deployable with "),e("strong",[t._v("Kargo")])])]),t._v(" "),e("h3",{attrs:{id:"configuring-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-gateway"}},[t._v("#")]),t._v(" Configuring the gateway")]),t._v(" "),e("h4",{attrs:{id:"defining-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-gateway"}},[t._v("#")]),t._v(" Defining the gateway")]),t._v(" "),e("p",[t._v("To define you gateway, you simply need to:")]),t._v(" "),e("ol",[e("li",[t._v("create a "),e("code",[t._v("gateway.config.yml")]),t._v(" file in the "),e("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),e("li",[t._v("edit the file and define your gateway. Check the documentation "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/configuration/gateway.config.yml/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("Here is an example of gateway implementing the mapping illustrated by the following schema:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(359),alt:"kargo-gateway"}})]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express-gateway'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wms*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wmts/*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/k2/*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:9876'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080/wmts'")]),t._v("      \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://k2:8080'")]),t._v(" \n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cors\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipelines")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wms\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wms \n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("       \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wmts\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("           \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wmts \n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("                            \n\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" k2\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("              \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k2\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),e("p",[e("strong",[t._v("Kargo")]),t._v(" comes with various plugins that extends the "),e("strong",[t._v("express-gateway")]),t._v(" capabilities:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Plugin")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("strong",[t._v("populate")])]),t._v(" "),e("td",[t._v("It populates the gateway according the "),e("code",[t._v("consumers.config.js")]),t._v(" file.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("scopes")])]),t._v(" "),e("td",[t._v("It provides a "),e("strong",[t._v("policy")]),t._v(" that can be used to check the consumer scopes against the endpoint scopes.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("metrics")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("metrics")]),t._v(" route to the gateway application that can be used by "),e("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),e("OutboundLink")],1),t._v(" to scrape requests metrics.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("s3")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("s3")]),t._v(" route to the admin application that can be uses to proxy the requests to an "),e("strong",[t._v("S3")]),t._v(" bucket. The service endpoint to be used is: "),e("code",[t._v("http://localhost:9876/s3")])])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("healthcheck")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("healthcheck")]),t._v(" route to be used to check the health of "),e("strong",[t._v("express gateway")]),t._v(". "),e("strong",[t._v("Kargo")]),t._v(" uses this route to ensure the healthcheck of the service.")])])])]),t._v(" "),e("h4",{attrs:{id:"defining-the-consumers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-consumers"}},[t._v("#")]),t._v(" Defining the consumers")]),t._v(" "),e("p",[t._v("Once the gateway is implemented and started, it is necessary to define the consumers.")]),t._v(" "),e("ol",[e("li",[t._v("create a "),e("code",[t._v("consumers.config.js")]),t._v(" file in the "),e("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),e("li",[t._v("edit the file and define your consumers using the following formalism:")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  users"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cutomer1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      qgis"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'basic-auth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PASSWORD>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      leafet"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customer2"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Refer to the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/consumer-management/",target:"_blank",rel:"noopener noreferrer"}},[t._v("consumer-management"),e("OutboundLink")],1),t._v(" section to learn mode about "),e("code",[t._v("keyId")]),t._v(" and "),e("code",[t._v("keySecret")]),t._v(".")])]),t._v(" "),e("h4",{attrs:{id:"running-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#running-the-gateway"}},[t._v("#")]),t._v(" Running the gateway")]),t._v(" "),e("p",[t._v("You must simply execute the following procedure:")]),t._v(" "),e("ol",[e("li",[t._v("define a stack with the "),e("code",[t._v("express-gateway")]),t._v(" service")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not forget to declare the stack in STACKS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("API_STACK")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express-gateway"')]),t._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("configure "),e("strong",[t._v("Kargo")]),t._v(":")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo configure kargo\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("build the "),e("strong",[t._v("express gateway")]),t._v(" docker image:")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo build express-gateway\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[t._v("deploy the stack")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo deploy api\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" used the "),e("code",[t._v("populate")]),t._v(" plugin to automatically populate the gateway at startup.")])]),t._v(" "),e("h3",{attrs:{id:"managing-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#managing-the-gateway"}},[t._v("#")]),t._v(" Managing the gateway")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" relies on the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express-gateway cli"),e("OutboundLink")],1),t._v(" to manage the gateway:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -ti "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("express-gateway-container-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v(" list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kalisio"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("eg apps list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kano"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms,wmts,wfs,wcs,s3"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg credentials list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consumerId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3d981c1b-b0af-4139-a2ca-e304a4f018a6"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wfs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wcs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keySecret"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SECRET"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jwt"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"extending-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extending-the-services"}},[t._v("#")]),t._v(" Extending the services")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" allows you to extend the default services settings for a given cluster. You can either overwrite the default settings files of a service or extend the way the service will be deployed (specify the healthcheck, add some constraints...)")]),t._v(" "),e("p",[t._v("For this you must create a directory structure in your workspace similar to that of "),e("strong",[t._v("Kargo")]),t._v(" where you will put your stuff.")]),t._v(" "),e("p",[t._v("For instance, if we have 2 services, "),e("code",[t._v("service-1")]),t._v(" and "),e("code",[t._v("service-2")]),t._v(", and we want to:")]),t._v(" "),e("ul",[e("li",[t._v("overwrite the configuration of "),e("code",[t._v("service-1")]),t._v(" as well as extend the its deployment method.")]),t._v(" "),e("li",[t._v("overwrite the configuration of "),e("code",[t._v("service-2")]),t._v(" only.")])]),t._v(" "),e("p",[t._v("Then, the directory structure will look like:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ deploy\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yml   the yml extension you want to apply when deployin the service-1\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ configs\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-1 you need to overwrite \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-2 you need to overwrite \n")])])]),e("p",[t._v("When extending the deployment method of a service, you must tell "),e("strong",[t._v("Kargo")]),t._v(" which file to add when deploying the service.\nFor each service, you need to declare a variable in the "),e("code",[t._v(".env")]),t._v(" file which tell the name of the "),e("code",[t._v("yml")]),t._v(" file to take into account. In the previous example, the entry in the "),e("code",[t._v(".env")]),t._v(" file should look like:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SERVICE-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("_EXTENSION"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Before deploying, do not forget to make the "),e("strong",[t._v("merged configuration")]),t._v(" using the "),e("RouterLink",{attrs:{to:"/reference/cli.html#configure"}},[t._v("configure")]),t._v(" command.")],1)]),t._v(" "),e("h2",{attrs:{id:"packaging-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#packaging-the-services"}},[t._v("#")]),t._v(" Packaging the services")]),t._v(" "),e("p",[t._v("It may be useful to package images of certain services (be.g. built services) to store a version or to deliver to a client who cannot access the registers.\nTo do this, you can use the "),e("RouterLink",{attrs:{to:"/reference/cli.html#image-save"}},[t._v("image save")]),t._v(" command:")],1),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo image save vigicrues\n$./kargo image save tileservergl\n$./kargo image save mongodb\n$./kargo image save redis\n$./kargo image save thredds\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ls")]),t._v(" -al archives\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1369520")]),t._v("\ndrwxrwxr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" ubuntu ubuntu      "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":22 "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndrwxrwxr-x "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" ubuntu ubuntu      "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":25 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu         "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":09 .gitkeep\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("130735307")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":36 kalisio.k-vigicrues_1.0.0.tar.gz\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("468515606")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":28 klokantech.tileserver-gl_v2.4.0.tar.gz\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128983975")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":26 mongo_3.6.5.tar.gz\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("34773857")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":26 redis_5.tar.gz\n-rw-rw-r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ubuntu ubuntu "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("508610419")]),t._v(" Feb "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":32 unidata.thredds-docker_4.6.11.tar.gz\n")])])]),e("p",[t._v("Or better, you can write your own script to packages the required services and use the command "),e("RouterLink",{attrs:{to:"/reference/cli.html#exec"}},[t._v("exec")]),t._v(" to launch the process. The following scripts iterates through the services and generate an archive. Once finished it copies the archives to an ObjectStorage using "),e("a",{attrs:{href:"https://rclone.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rclone"),e("OutboundLink")],1),t._v(".")],1),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DELIERY is defined in your .env file")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# DELIVERY="vigicrues tileservergl mongodb redis thredds"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[t._v("SERVICE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DELIVERY")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" packaging "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SERVICE")]),t._v("\n  ./kargo image save "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SERVICE")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nrclone copy archives s3:bucket/path --include *.gz\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);