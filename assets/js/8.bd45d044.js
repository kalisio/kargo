(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{504:function(t,s,a){t.exports=a.p+"assets/img/kargo-traefik.21ca1aa0.svg"},505:function(t,s,a){t.exports=a.p+"assets/img/kargo-gateway.293e1ae6.svg"},528:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"advanced-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#advanced-usage"}},[t._v("#")]),t._v(" Advanced usage")]),t._v(" "),e("h2",{attrs:{id:"routing-the-traffic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#routing-the-traffic"}},[t._v("#")]),t._v(" Routing the traffic")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" relies on "),e("a",{attrs:{href:"https://containo.us/traefik/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik"),e("OutboundLink")],1),t._v(" to manage the incoming requests to the platform. "),e("strong",[t._v("Traefik")]),t._v(" is a reverse proxy and load balancer that help routes the incoming requests to the deployed services (backend) using so called "),e("a",{attrs:{href:"https://docs.traefik.io/v1.7/basics/#frontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("frontends"),e("OutboundLink")],1),t._v(". A frontend consists of a set of rules that determine how incoming requests are forwarded from an entry point to a backend.")]),t._v(" "),e("p",[e("img",{attrs:{src:a(504),alt:"kargo-traefik"}})]),t._v(" "),e("p",[t._v("By default "),e("strong",[t._v("Traefik")]),t._v(" is configured with 2 entry points:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("80")]),t._v(": this port ensures HTTP traffic. It is mainly used to enable "),e("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Let's Encrypt"),e("OutboundLink")],1),t._v(" ACME management. However, the port is redirected to the port "),e("code",[t._v("443")])]),t._v(" "),e("li",[e("code",[t._v("443")]),t._v(": this port ensures HTTPS traffic.")])]),t._v(" "),e("p",[t._v("The services provided by "),e("strong",[t._v("Kargo")]),t._v(" are already configured to be automatically discovered by "),e("strong",[t._v("Traefik")]),t._v(" once deployed. Sometimes you may need to override or extend this configuration. See the section "),e("a",{attrs:{href:"#extending-the-services"}},[t._v("extending the services")]),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" still uses the version "),e("code",[t._v("1.7")]),t._v(" of "),e("strong",[t._v("Traefik")]),t._v(". Check the documentation "),e("a",{attrs:{href:"https://docs.traefik.io/v1.7/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("When testing the your configuration, we highly recommend to use the "),e("strong",[t._v("staging")]),t._v(" mode provided by "),e("strong",[t._v("Let's Encrypt")]),t._v(" otherwise you may reach the "),e("a",{attrs:{href:"https://letsencrypt.org/docs/rate-limits/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rate limits"),e("OutboundLink")],1),t._v(".\nSetup the variable "),e("code",[t._v("TRAEFIK_ACME_SERVER")]),t._v(" with the following url "),e("code",[t._v("https://acme-staging-v02.api.letsencrypt.org/directory")])])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("For security reason, "),e("strong",[t._v("Traefik")]),t._v(" relies on "),e("a",{attrs:{href:"https://github.com/Tecnativa/docker-socket-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-socket-proxy"),e("OutboundLink")],1),t._v(" to secure the access to the Docker socket. Read this "),e("a",{attrs:{href:"https://docs.traefik.io/providers/docker/#docker-api-access",target:"_blank",rel:"noopener noreferrer"}},[t._v("note"),e("OutboundLink")],1),t._v(" to learn more about this security concern.")])]),t._v(" "),e("h2",{attrs:{id:"using-the-api-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-the-api-gateway"}},[t._v("#")]),t._v(" Using the API Gateway")]),t._v(" "),e("p",[t._v("As a reminder, an API gateway allows you to map endpoints to a set of services or applications using url rules. Moreover it is possible to protect those endpoints using various authorization strategies ("),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Key_authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("Key authentication"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON Web Tokens"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://oauth.net/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth"),e("OutboundLink")],1),t._v("...) and defining quotas and rate limiting. To enable such a features "),e("strong",[t._v("Kargo")]),t._v(" relies on "),e("a",{attrs:{href:"https://www.express-gateway.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express gateway"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("We recommend that you read the "),e("strong",[t._v("express gateway")]),t._v(" "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),e("OutboundLink")],1),t._v(" before starting.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[e("strong",[t._v("express gateway")]),t._v(" relies on "),e("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),e("OutboundLink")],1),t._v(" to store the consumers data. In order to check your configuration, "),e("a",{attrs:{href:"https://joeferner.github.io/redis-commander/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Commander"),e("OutboundLink")],1),t._v(" is a convenient solution to explore the "),e("strong",[t._v("Redis")]),t._v(" data store. These 2 applications are easily deployable with "),e("strong",[t._v("Kargo")])])]),t._v(" "),e("h3",{attrs:{id:"configuring-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-gateway"}},[t._v("#")]),t._v(" Configuring the gateway")]),t._v(" "),e("h4",{attrs:{id:"defining-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-gateway"}},[t._v("#")]),t._v(" Defining the gateway")]),t._v(" "),e("p",[t._v("To define you gateway, you simply need to:")]),t._v(" "),e("ol",[e("li",[t._v("create a "),e("code",[t._v("gateway.config.yml")]),t._v(" file in the "),e("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),e("li",[t._v("edit the file and define your gateway. Check the documentation "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/configuration/gateway.config.yml/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("Here is an example of gateway implementing the mapping illustrated by the following schema:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(505),alt:"kargo-gateway"}})]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express-gateway'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wms*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wmts/*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/k2/*'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:9876'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080/wmts'")]),t._v("      \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://k2:8080'")]),t._v(" \n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cors\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipelines")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wms\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wms \n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("       \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wmts\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("           \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wmts \n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("                            \n\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" k2\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("              \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k2\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),e("p",[e("strong",[t._v("Kargo")]),t._v(" comes with various plugins that extends the "),e("strong",[t._v("express-gateway")]),t._v(" capabilities:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Plugin")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("strong",[t._v("populate")])]),t._v(" "),e("td",[t._v("It populates the gateway according the "),e("code",[t._v("consumers.config.js")]),t._v(" file.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("scopes")])]),t._v(" "),e("td",[t._v("It provides a "),e("strong",[t._v("policy")]),t._v(" that can be used to check the consumer scopes against the endpoint scopes.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("metrics")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("metrics")]),t._v(" route to the gateway application that can be used by "),e("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),e("OutboundLink")],1),t._v(" to scrape requests metrics.")])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("s3")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("s3")]),t._v(" route to the admin application that can be uses to proxy the requests to an "),e("strong",[t._v("S3")]),t._v(" bucket. The service endpoint to be used is: "),e("code",[t._v("http://localhost:9876/s3")])])]),t._v(" "),e("tr",[e("td",[e("strong",[t._v("healthcheck")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("healthcheck")]),t._v(" route to be used to check the health of "),e("strong",[t._v("express gateway")]),t._v(". "),e("strong",[t._v("Kargo")]),t._v(" uses this route to ensure the healthcheck of the service.")])])])]),t._v(" "),e("h4",{attrs:{id:"defining-the-consumers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-consumers"}},[t._v("#")]),t._v(" Defining the consumers")]),t._v(" "),e("p",[t._v("Once the gateway is implemented and started, it is necessary to define the consumers.")]),t._v(" "),e("ol",[e("li",[t._v("create a "),e("code",[t._v("consumers.config.js")]),t._v(" file in the "),e("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),e("li",[t._v("edit the file and define your consumers using the following formalism:")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  users"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cutomer1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      qgis"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'basic-auth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PASSWORD>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      leafet"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customer2"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Refer to the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/consumer-management/",target:"_blank",rel:"noopener noreferrer"}},[t._v("consumer-management"),e("OutboundLink")],1),t._v(" section to learn mode about "),e("code",[t._v("keyId")]),t._v(" and "),e("code",[t._v("keySecret")]),t._v(".")])]),t._v(" "),e("h4",{attrs:{id:"running-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#running-the-gateway"}},[t._v("#")]),t._v(" Running the gateway")]),t._v(" "),e("p",[t._v("You must simply execute the following procedure:")]),t._v(" "),e("ol",[e("li",[t._v("define a stack with the "),e("code",[t._v("express-gateway")]),t._v(" service")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not forget to declare the stack in STACKS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("API_STACK")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express-gateway"')]),t._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("configure "),e("strong",[t._v("Kargo")]),t._v(":")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo configure kargo\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("build the "),e("strong",[t._v("express gateway")]),t._v(" docker image:")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo build express-gateway\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[t._v("deploy the stack")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$./kargo deploy api\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" used the "),e("code",[t._v("populate")]),t._v(" plugin to automatically populate the gateway at startup.")])]),t._v(" "),e("h3",{attrs:{id:"managing-the-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#managing-the-gateway"}},[t._v("#")]),t._v(" Managing the gateway")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" relies on the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express-gateway cli"),e("OutboundLink")],1),t._v(" to manage the gateway:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -ti "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("express-gateway-container-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v(" list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kalisio"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("eg apps list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kano"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms,wmts,wfs,wcs,s3"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg credentials list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consumerId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3d981c1b-b0af-4139-a2ca-e304a4f018a6"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wfs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wcs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keySecret"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SECRET"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jwt"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"configuring-proxy-settings"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-proxy-settings"}},[t._v("#")]),t._v(" Configuring proxy settings")]),t._v(" "),e("p",[t._v("When you choose an on-premises deployment, it may be necessary to configure "),e("strong",[t._v("Kargo")]),t._v(" to use the corporate proxy server.\nTo use a proxy, you can set the environment variables "),e("code",[t._v("HTTP_PROXY")]),t._v(", "),e("code",[t._v("HTTPS_PROXY")]),t._v(", "),e("code",[t._v("FTP_PROXY")]),t._v(" and "),e("code",[t._v("NO_PROXY")]),t._v(".")]),t._v(" "),e("p",[t._v("Depending on the traffic type, set the required variables in your "),e("code",[t._v(".env")]),t._v(" file:")]),t._v(" "),e("div",{staticClass:"language-env extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('HTTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nHTTPS_PROXY="https://USER:PASSWORD@PROXY_SERVER:PORT"\nFTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nNO_PROXY="localhost"\n')])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("NO_PROXY")]),t._v(" must at least contain the value "),e("code",[t._v("localhost")]),t._v(" to let the Krawler jobs healthcheck work correctly.")])]),t._v(" "),e("h2",{attrs:{id:"using-mongors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-mongors"}},[t._v("#")]),t._v(" Using Mongors")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" provides a "),e("RouterLink",{attrs:{to:"/reference/environment.html#mongors"}},[t._v("Mongors")]),t._v(" service that can help you setting up a "),e("a",{attrs:{href:"https://docs.mongodb.com/manual/replication/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB Replica Set"),e("OutboundLink")],1),t._v(". It creates 3 "),e("strong",[t._v("MongoDB")]),t._v(" instances, "),e("code",[t._v("mongodb0")]),t._v(", "),e("code",[t._v("mongodb1")]),t._v(" and "),e("code",[t._v("mongodb2")]),t._v(", configured to be used as a "),e("strong",[t._v("Replica Set")]),t._v(" named "),e("code",[t._v("mongors")]),t._v(".")],1),t._v(" "),e("h3",{attrs:{id:"setting-up-the-replica-set"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-replica-set"}},[t._v("#")]),t._v(" Setting up the Replica Set")]),t._v(" "),e("p",[t._v("Execute the following procedure")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("You first need to assign a constraint label on the nodes where you want to deploy the "),e("strong",[t._v("MongoDB")]),t._v(" instances.")])]),t._v(" "),e("li",[e("p",[t._v("Declare the service "),e("strong",[t._v("mongors")]),t._v(" within a stack of your choice. We recommend to use a dedicated stack.")])]),t._v(" "),e("li",[e("p",[t._v("Deploy the stack and therefore the service")])]),t._v(" "),e("li",[e("p",[t._v("Start a session on the "),e("strong",[t._v("Primary")]),t._v(" container:")])])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -ti "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("constainer_id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[e("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/deploy-replica-set/#initiate-the-replica-set",target:"_blank",rel:"noopener noreferrer"}},[t._v("Initiate"),e("OutboundLink")],1),t._v(" the "),e("strong",[t._v("Replica Set")])])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'rs.initiate({ _id: "mongors", version: 1, members: [ { _id: 0, host : "mongors0:27017" }, { _id: 1, host : "mongors1:27017" }, { _id: 2, host : "mongors2:27017" } ] })\'')]),t._v("\n")])])]),e("ol",{attrs:{start:"6"}},[e("li",[e("a",{attrs:{href:"https://docs.mongodb.com/manual/core/replica-set-oplog/#workloads-that-might-require-a-larger-oplog-size",target:"_blank",rel:"noopener noreferrer"}},[t._v("Maybe define a bigger OpLog size"),e("OutboundLink")],1),t._v(". You'll need to run this on all replica set members that may become primary.")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors1 --eval "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors2 --eval "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n")])])]),e("ol",{attrs:{start:"7"}},[e("li",[e("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/troubleshoot-replica-sets/#check-replica-set-status",target:"_blank",rel:"noopener noreferrer"}},[t._v("Check the status"),e("OutboundLink")],1),t._v(" of the "),e("strong",[t._v("Replica Set")])])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rs.status()'")]),t._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("You can override the name of the "),e("strong",[t._v("Replica Set")]),t._v(" (as well as the "),e("strong",[t._v("MongoDB")]),t._v(" instances) by setting the "),e("code",[t._v("MONGORS_NAME")]),t._v(" variable. By default the "),e("strong",[t._v("Replica Set")]),t._v(" is named "),e("code",[t._v("mongors")]),t._v(".")])]),t._v(" "),e("h3",{attrs:{id:"troubleshooting-the-replica-set"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-the-replica-set"}},[t._v("#")]),t._v(" Troubleshooting the Replica Set")]),t._v(" "),e("p",[t._v("A member of a replica set could enter "),e("code",[t._v("RECOVERING")]),t._v(" state when it is not ready to accept reads.\nTo restore the instance in a core state, you may want to turn off the container, remove the volume and restart the container. The member will begin an initial sync and remain in "),e("code",[t._v("STARTUP2")]),t._v(" state. Afterwards, the member will transit to  "),e("code",[t._v("RECOVERING")]),t._v(" state and then its core state.")]),t._v(" "),e("h2",{attrs:{id:"extending-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extending-the-services"}},[t._v("#")]),t._v(" Extending the services")]),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" allows you to extend the default services settings for a given cluster. You can either overwrite the default settings files of a service or extend the way the service will be deployed (specify the healthcheck, add some constraints...)")]),t._v(" "),e("p",[t._v("For this you must create a directory structure in your workspace similar to that of "),e("strong",[t._v("Kargo")]),t._v(" where you will put your stuff.")]),t._v(" "),e("p",[t._v("For instance, if we have 2 services, "),e("code",[t._v("service-1")]),t._v(" and "),e("code",[t._v("service-2")]),t._v(", and we want to:")]),t._v(" "),e("ul",[e("li",[t._v("overwrite the configuration of "),e("code",[t._v("service-1")]),t._v(" as well as extend the its deployment method.")]),t._v(" "),e("li",[t._v("overwrite the configuration of "),e("code",[t._v("service-2")]),t._v(" only.")])]),t._v(" "),e("p",[t._v("Then, the directory structure will look like:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ deploy\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yml   the yml extension you want to apply when deployin the service-1\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ configs\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-1 you need to overwrite \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-2 you need to overwrite \n")])])]),e("p",[t._v("When extending the deployment method of a service, you must tell "),e("strong",[t._v("Kargo")]),t._v(" which file to add when deploying the service.\nFor each service, you need to declare a variable in the "),e("code",[t._v(".env")]),t._v(" file which tell the name of the "),e("code",[t._v("yml")]),t._v(" file to take into account. In the previous example, the entry in the "),e("code",[t._v(".env")]),t._v(" file should look like:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SERVICE-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("_EXTENSION"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Before deploying, do not forget to make the "),e("strong",[t._v("merged configuration")]),t._v(" using the "),e("RouterLink",{attrs:{to:"/reference/cli.html#configure"}},[t._v("configure")]),t._v(" command.")],1)]),t._v(" "),e("h2",{attrs:{id:"using-hooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-hooks"}},[t._v("#")]),t._v(" Using hooks")]),t._v(" "),e("p",[t._v("Sometimes, it may be useful to execute some scripts before or after a service is deployed. This is the purpose of the hooks.\nTo declare a before or an after hook, create a script in the "),e("code",[t._v("deploy")]),t._v(" folder named "),e("code",[t._v("<service>_before.sh")]),t._v(" or "),e("code",[t._v("<service>_after.sh")]),t._v(".\nThe script will automatically executed when deploying the service.")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Note that "),e("code",[t._v("after")]),t._v(" hooks are executed once the complete stack is deployed.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);