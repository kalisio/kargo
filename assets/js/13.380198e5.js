(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{178:function(t,e,a){"use strict";a.r(e);var s=a(0),r=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("To be able to use "),a("a",{attrs:{href:"http://www.gdal.org/gdal_utilities.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GDAL Utilities "),a("OutboundLink")],1),t._v(", we recommend to run a GDAL container and mount the data partition:")]),t._v(" "),t._m(2),a("p",[t._v("You are now able to use GDAL:")]),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),a("p",[t._v("The "),a("strong",[t._v("kargo-toolbox")]),t._v(" project comes with the "),a("a",{attrs:{href:"https://github.com/icetan/sqlitepipe",target:"_blank",rel:"noopener noreferrer"}},[t._v("sqlitepipe"),a("OutboundLink")],1),t._v(" utility that can be used for this purpose. The following example shows how to use "),a("strong",[t._v("sqlitepipe")]),t._v(" and "),a("a",{attrs:{href:"https://www.imagemagick.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ImageMagick"),a("OutboundLink")],1),t._v(" to make white pixels transparent on all of the tiles stored within the MBTiles file.")]),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),a("p",[t._v("The generation is based on the "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenMapTiles"),a("OutboundLink")],1),t._v(" project toolbox.")]),t._v(" "),a("p",[t._v("To generate OSM data we start from a fresh Scaleway server with a Docker image, it already contains docker, git, pip, gcc, etc.")]),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("Because you will need a lot of storage here is "),a("a",{attrs:{href:"https://www.scaleway.com/docs/attach-and-detach-a-volume-to-an-existing-server/",target:"_blank",rel:"noopener noreferrer"}},[t._v("how to add a volume"),a("OutboundLink")],1),t._v(":")]),t._v(" "),t._m(12),a("p",[t._v("To automount it: https://community.online.net/t/automatic-mounting-of-additional-volumes-using-systemd-on-ubuntu/3102")]),t._v(" "),a("p",[t._v("Because some data (eg PG data) are generated in docker volumes it is necessary to "),a("a",{attrs:{href:"https://forums.docker.com/t/how-do-i-change-the-docker-image-installation-directory/1169",target:"_blank",rel:"noopener noreferrer"}},[t._v("change the default docker location to your volumes"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("Rendering the whole planet is a "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles/issues/242",target:"_blank",rel:"noopener noreferrer"}},[t._v("tricky thing"),a("OutboundLink")],1),t._v(", so for now we prefer to:")]),t._v(" "),a("ul",[a("li",[t._v("contribute with a Pull Request to the community maintained open-source official vector tile schema so that the changes will be part of the future public OpenMapTiles releases and maintained")]),t._v(" "),a("li",[t._v("render only the features needed into a separate MBTiles files with new layers - and combine the standard planet with the extra layers - this is doable easily with JSON GL style and software stack powered by "),a("a",{attrs:{href:"https://mapnik.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("mapnik"),a("OutboundLink")],1),t._v(" or "),a("a",{attrs:{href:"https://github.com/mapbox/tippecanoe",target:"_blank",rel:"noopener noreferrer"}},[t._v("tippecanoe"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("li",[t._v("the extra layers can be also generated on demand directly from PostGIS by a third party tile servers and combined into a single map with TileServer GL - and served via composed vector tiles or raster tiles\n"),a("ul",[a("li",[a("a",{attrs:{href:"http://geoserver.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GeoServer"),a("OutboundLink")],1),t._v(" as vector/raster tiles")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/terranodo/tegola",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tegola"),a("OutboundLink")],1),t._v(" directly as MVT")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/t-rex-tileserver/t-rex",target:"_blank",rel:"noopener noreferrer"}},[t._v("T-Rex"),a("OutboundLink")],1),t._v(" directly as MVT")])])])]),t._v(" "),a("p",[t._v("For small extractions it's possible to use the "),a("a",{attrs:{href:"http://overpass-turbo.eu/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OverPass API"),a("OutboundLink")],1),t._v(", eg to extract taxiways/runways in a zone:")]),t._v(" "),t._m(13),a("p",[t._v("We also use the "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles/blob/master/QUICKSTART.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("quickstart script"),a("OutboundLink")],1),t._v(" to generate data (the link contains useful information about required architecture/sizing):")]),t._v(" "),t._m(14),a("p",[t._v("For a layer covering the planet first download the "),a("a",{attrs:{href:"https://planet.openstreetmap.org/pbf/",target:"_blank",rel:"noopener noreferrer"}},[t._v("whole planet"),a("OutboundLink")],1),t._v(" in the "),a("em",[t._v("data")]),t._v(" directory and launch the process:")]),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("You should clean everything before relaunching:")]),t._v(" "),t._m(18),a("p",[t._v("Here is a list of interesting documentation:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://eprints.hsr.ch/536/1/thesis_updatable_vector_tiles_from_openstreetmap.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kloklantech thesis"),a("OutboundLink")],1),t._v(" detailing the whole toolchain")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://fuzzytolerance.info/blog/2017/04/25/Generating-your-own-OpenMapTiles/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tutorial video"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=D7mmXonFIqA&feature=youtu.be",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mapbox presentation"),a("OutboundLink")],1)])]),t._v(" "),t._m(19),t._v(" "),a("p",[t._v("When running a process that last a long time, your SSH connection can be shut down causing the process to stop. To avoid this problem, one solution is to use "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/GNU_Screen",target:"_blank",rel:"noopener noreferrer"}},[t._v("screen"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("Here are the basics to know:")]),t._v(" "),t._m(20),t._v(" "),a("p",[t._v("Check the "),a("a",{attrs:{href:"https://www.gnu.org/software/screen/manual/screen.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),a("OutboundLink")],1),t._v(" to learn more.")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"tips"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tips","aria-hidden":"true"}},[this._v("#")]),this._v(" Tips")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-use-gdal-utilities"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use-gdal-utilities","aria-hidden":"true"}},[this._v("#")]),this._v(" How to use GDAL Utilities ?")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$docker")]),this._v(" run  -v /mnt/data:/data -t -i kalisio/kargo-toolbox:latest /bin/bash\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$gdalinfo")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("<")]),this._v("path_to_the_file"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v(">")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you need to access another container you will need to run the GDAL container within the same network. For instance, the following command will allow you to link the GDAL container to an existing "),e("code",[this._v("Postgis")]),this._v(" container in the network "),e("code",[this._v("kargo")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$docker")]),this._v(" run --network"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("kargo  -v /mnt/data:/data -t -i kalisio/kargo-toolbox:latest /bin/bash\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-post-process-an-mbtiles-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-post-process-an-mbtiles-file","aria-hidden":"true"}},[this._v("#")]),this._v(" How to post process an MBTiles file ?")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sqlite3 my-mbtiles.mbtiles\nUPDATE tiles SET tile_data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pipe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tile_data, "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/bin/convert'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-transparent'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'white'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'png:-'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'png:-'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nVACUUM tiles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n.quit\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("According the size of the MBTiles to process you may encounter such an error: "),a("code",[t._v("Error: database or disk is full")]),t._v("\nYou should tell "),a("strong",[t._v("sqlite")]),t._v(" to use a free disk space to work with the temp files:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("sqlite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pragma temp_store "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsqlite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pragma temp_store_directory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/directory/with/lots/of/space'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("p",[this._v("Note that "),e("strong",[this._v("kargo-toolbox")]),this._v(" provides the "),e("strong",[this._v("ImageMagick")]),this._v(" tool")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-generate-openstreetmap-data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-generate-openstreetmap-data","aria-hidden":"true"}},[this._v("#")]),this._v(" How to generate OpenStreetMap data ?")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),e("p",[this._v("Git clone using HTTPS instead of git protocol on Scaleway.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$mkfs")]),this._v(" -t ext4 /dev/nbd1\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$mkdir")]),this._v(" -p /mnt/data\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$mount")]),this._v(" /dev/nbd1 /mnt/data\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('[out:json][timeout:25];\n// gather results\n(\n  // query part for: “aeroway=runway”\n  node["aeroway"="runway"]({{bbox}});\n  way["aeroway"="runway"]({{bbox}});\n  relation["aeroway"="runway"]({{bbox}});\n  // query part for: “aeroway=taxiway”\n  node["aeroway"="taxiway"]({{bbox}});\n  way["aeroway"="taxiway"]({{bbox}});\n  relation["aeroway"="taxiway"]({{bbox}});\n);\n// print results\nout body;\n>;\nout skel qt;\n')])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$git")]),t._v(" clone https://github.com/openmaptiles/openmaptiles\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cd")]),t._v(" openmaptiles\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$make")]),t._v("\n$./quickstart.sh france "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" logs 2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" // could be country, region, etc. but not planet\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cd")]),t._v(" data\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$wget")]),t._v(" https://planet.openstreetmap.org/pbf/planet-latest.osm.pbf\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mv")]),t._v(" planet-latest.osm.pbf planet.osm.pbf\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n$./quickstart.sh planet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" logs 2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n// To see result\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" run -it --rm -v /mnt/data/openmaptiles/data:/data -p 80:80 klokantech/tileserver-gl\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Using a Scaleway C2L configuration (€23.99/month, €0.048/hour, 8 Dedicated X86 64bit Cores, 32GB memory, 250GB Direct SSD, 800Mbit/s Unmetered) processing the "),e("code",[this._v("aeroway")]),this._v(" layer on the planet takes ~ 16 000 s and 120 GB.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("p",[this._v("Launching the script against the same data set again does not seem to correctly update the generation configuration.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$make")]),t._v(" clean-docker\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$make")]),t._v(" forced-clean-sql\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$rm")]),t._v(" -fr data build\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$make")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-execute-a-long-process-from-your-ssh-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-execute-a-long-process-from-your-ssh-session","aria-hidden":"true"}},[this._v("#")]),this._v(" How to execute a long process from your SSH session ?")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ol",[a("li",[t._v("Create a screen: "),a("code",[t._v("sreen -S my-session")])]),t._v(" "),a("li",[t._v("Launch your process: "),a("code",[t._v("execute my long process")])]),t._v(" "),a("li",[t._v("Leave your screen: "),a("code",[t._v("[ctrl]+[a]")]),t._v(" then "),a("code",[t._v("[d]")])]),t._v(" "),a("li",[t._v("List the screens: "),a("code",[t._v("screen -ls")])]),t._v(" "),a("li",[t._v("Going back to your screen: "),a("code",[t._v("screen -r my-session")])])])}],!1,null,null,null);r.options.__file="README.md";e.default=r.exports}}]);