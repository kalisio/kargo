(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{506:function(e,t,a){e.exports=a.p+"assets/img/kargo-example-assumptions.0161491c.svg"},528:function(e,t,a){"use strict";a.r(t);var s=a(13),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"getting-started"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-started"}},[e._v("#")]),e._v(" Getting Started")]),e._v(" "),s("p",[e._v("Using "),s("strong",[e._v("kargo")]),e._v(" is quite easy and basically the approach to setup your Geospatial platform is the following:")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#prepare-the-infrastructure"}},[e._v("Prepare the infrastructure")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#setup-the-services"}},[e._v("Setup the services")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#manage-the-services"}},[e._v("Manage the services")])])]),e._v(" "),s("p",[e._v("In the following guides, we will explain how to deploy a complete set of services on a given infrastructure such as illustrated in this diagram:")]),e._v(" "),s("p",[s("img",{attrs:{src:a(506),alt:"kargo-example-assumptions"}})]),e._v(" "),s("p",[e._v("Thus, we assume you already have a running Swarm infrastructure with:")]),e._v(" "),s("ul",[s("li",[e._v("A manager node")]),e._v(" "),s("li",[e._v("Multiple worker nodes with sufficient disk space to store the data")])]),e._v(" "),s("p",[e._v("Check your infrastructure using the command "),s("code",[e._v("docker node ls")]),e._v(", you should have a response similar to:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$docker")]),e._v(" node "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\nID                            "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("HOSTNAME")]),e._v("            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\njqtuxajexk18ypiylk6i6dv0q     worker-0            Ready               Active                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("18.03")]),e._v(".1-ce\nx6tc2sqi99vp106icwf2nmyp0 *   manager             Ready               Active              Leader              "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("18.03")]),e._v(".1-ce\nwfr5hwhfd5413p2ql9hwitbkw     worker-1            Ready               Active                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("18.03")]),e._v(".1-ce\n8980x3d76x1r7kxoa7h5lzob8     worker-2            Ready               Active                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("18.03")]),e._v(".1-ce\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("Prerequisites")]),e._v(" "),s("p",[e._v("If you do not have such an infrastructure, you may have a look at "),s("a",{attrs:{href:"https://kalisio.github.io/kaabah/",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[e._v("Kaabah")]),s("OutboundLink")],1),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"prepare-the-infrastructure"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-infrastructure"}},[e._v("#")]),e._v(" Prepare the infrastructure")]),e._v(" "),s("h3",{attrs:{id:"install-the-prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-the-prerequisites"}},[e._v("#")]),e._v(" Install the prerequisites")]),e._v(" "),s("h4",{attrs:{id:"install-rclone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-rclone"}},[e._v("#")]),e._v(" Install rclone")]),e._v(" "),s("p",[s("strong",[e._v("rclone")]),e._v(" is used to provision the nodes with the static data that are used by the services (i.e. geospatial datasets, docker images...). "),s("strong",[e._v("rclone")]),e._v(" allows you to retrieve these data from most\nof the well know stores such as "),s("strong",[e._v("AWS S3")]),e._v(", "),s("strong",[e._v("OpenStack Object Store")]),e._v(", "),s("strong",[e._v("Google Drive")]),e._v(".\nYou need to install "),s("strong",[e._v("rclone")]),e._v(" on each worker:")]),e._v(" "),s("ol",[s("li",[e._v("Install "),s("strong",[e._v("rclone")])])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" rclone\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Configure "),s("strong",[e._v("rclone")])])]),e._v(" "),s("p",[e._v("Use the "),s("a",{attrs:{href:"https://rclone.org/docs/#configure",target:"_blank",rel:"noopener noreferrer"}},[e._v("following guide"),s("OutboundLink")],1),e._v(" to setup "),s("strong",[e._v("rclone")])]),e._v(" "),s("h4",{attrs:{id:"install-jq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-jq"}},[e._v("#")]),e._v(" Install jq")]),e._v(" "),s("p",[s("strong",[s("a",{attrs:{href:"https://stedolan.github.io/jq/",target:"_blank",rel:"noopener noreferrer"}},[e._v("jq"),s("OutboundLink")],1)]),e._v(" is a lightweight and flexible command-line JSON processor. The CLI uses "),s("strong",[e._v("jq")]),e._v(" to extract some information from the "),s("code",[e._v("package.json")]),e._v(" file.")]),e._v(" "),s("p",[e._v("On the manager, type the following command:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" jq\n")])])]),s("h4",{attrs:{id:"install-yq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-yq"}},[e._v("#")]),e._v(" Install yq")]),e._v(" "),s("p",[s("strong",[s("a",{attrs:{href:"https://github.com/mikefarah/yq",target:"_blank",rel:"noopener noreferrer"}},[e._v("yq"),s("OutboundLink")],1)]),e._v(" is a lightweight and portable command-line YAML processor. The CLI uses "),s("strong",[e._v("yq")]),e._v(" to merge configuration files.")]),e._v(" "),s("p",[e._v("Please refer to the "),s("a",{attrs:{href:"https://github.com/mikefarah/yq#install",target:"_blank",rel:"noopener noreferrer"}},[e._v("installation section"),s("OutboundLink")],1),e._v(" to install "),s("strong",[e._v("yq")])]),e._v(" "),s("h4",{attrs:{id:"install-glusterfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-glusterfs"}},[e._v("#")]),e._v(" Install GlusterFS")]),e._v(" "),s("p",[e._v("To use "),s("strong",[e._v("Kargo")]),e._v(", it is required to share the configuration among the nodes of the swarm. To create a shared filesystem, we recommend to use "),s("strong",[s("a",{attrs:{href:"https://www.gluster.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("GlusterFS"),s("OutboundLink")],1)]),e._v(". Please refer to the "),s("a",{attrs:{href:"https://docs.gluster.org/en/latest/Quick-Start-Guide/Quickstart/",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"install-kargo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-kargo"}},[e._v("#")]),e._v(" Install kargo")]),e._v(" "),s("ol",[s("li",[e._v("Clone the "),s("strong",[e._v("Kargo")]),e._v(" repository")])]),e._v(" "),s("p",[e._v("On the manager node and clone the repository in the shared directory of your choice:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$git")]),e._v(" clone https://github.com/kalisio/kargo.git\n")])])]),s("h3",{attrs:{id:"provision-the-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#provision-the-data"}},[e._v("#")]),e._v(" Provision the data")]),e._v(" "),s("p",[e._v("It is up to you to copy your data to the different nodes. You must have to keep in mind that these data will have to be accessible by the services that you want to deploy.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Looking for data ?")]),e._v(" "),s("p",[e._v("We can provide datasets from different sources such as public catalogs and those of our partners such as "),s("a",{attrs:{href:"https://openmaptiles.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenMapTiles"),s("OutboundLink")],1),e._v(", "),s("a",{attrs:{href:"https://www.planetobserver.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("PlanetObserver"),s("OutboundLink")],1),e._v(". Do bot hesitate to contact us at "),s("strong",[e._v("contact@kalisio.com.")])])]),e._v(" "),s("h2",{attrs:{id:"setup-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-the-services"}},[e._v("#")]),e._v(" Setup the services")]),e._v(" "),s("h3",{attrs:{id:"setup-your-workspace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-your-workspace"}},[e._v("#")]),e._v(" Setup your workspace")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Create a directory to store your configuration stuff. Give it the name of your choice.")])]),e._v(" "),s("li",[s("p",[e._v("Create the "),s("strong",[e._v("Environment")]),e._v(" file by making a copy of the "),s("code",[e._v(".env.sample")]),e._v(" file into your configuration. Rename it as "),s("code",[e._v(".env")])])]),e._v(" "),s("li",[s("p",[e._v("Edit the "),s("code",[e._v(".env")]),e._v(" file and configure the services you want to deploy. See the section "),s("a",{attrs:{href:"./reference/environment"}},[e._v("Environment")]),e._v(" to have the complete reference of the services settings.")])]),e._v(" "),s("li",[s("p",[e._v("Define node constraints. For each node, define a variable "),s("code",[e._v("<NODE_NAME>_LABELS")]),e._v(" listing the labels to be assigned to the node")])])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MANAGER_LABELS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('""')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WORKER_0_LABELS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tileservergl=true mongodb=true"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WORKER_1_LABELS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tileservergl=true"')]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("To check you node labels mapping, use the following command:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$docker")]),e._v(" node "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -q "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("xargs")]),e._v(" docker node inspect -f "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{{ .ID }} [{{ .Description.Hostname }}]: {{ .Spec.Labels }}'")]),e._v("\n")])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("The labels you define on nodes can be used as placement constraints for the services you'll deploy, see "),s("a",{attrs:{href:"../reference/environment#placement-constraints"}},[e._v("here")])])]),e._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[e._v("Define the stacks you want to deploy:\n"),s("ol",[s("li",[e._v("Define the "),s("code",[e._v("STACKS")]),e._v(" variable listing the stacks")]),e._v(" "),s("li",[e._v("For each stack, define a variable "),s("code",[e._v("<STACK_NAME>_STACK")]),e._v(" listing the services to deploy")])])])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("STACKS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"dbs weacast hydro air apps"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("APPS_STACK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tileservergl mapproxy maputnik thredds kano"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("DBS_STACK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mongodb"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WEACAST_STACK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"arpege-world-loader arpege-europe-loader arome-france-loader gfs-world-loader weacast"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("VIGICRUES_HYDRO")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"vigicrues hubeau-stations hubeau-observations"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("AIR_STACK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"teleray openaq"')]),e._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[e._v("Tell kargo to use your workspace")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo use "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("path/to/your/workspace/directory"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("We strongly recommend to use "),s("strong",[e._v("Git")]),e._v(" to manage your workspace. If using "),s("strong",[e._v("Git")]),e._v(", you can take advantage of the command "),s("code",[e._v("kargo pull")]),e._v(" to pull the workspace.")])]),e._v(" "),s("ol",{attrs:{start:"7"}},[s("li",[e._v("Configure Kargo")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo configure\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[e._v("Create the constraint labels on the nodes")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo labels "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v("\n")])])]),s("h3",{attrs:{id:"build-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#build-the-services"}},[e._v("#")]),e._v(" Build the services")]),e._v(" "),s("p",[e._v("Some of the services provided By "),s("strong",[e._v("Kargo")]),e._v(" need to be built and pushed to the local registry in order to be able to deploy them.\nYou simply need to run the command:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo build "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("service"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("h2",{attrs:{id:"manage-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#manage-the-services"}},[e._v("#")]),e._v(" Manage the services")]),e._v(" "),s("h3",{attrs:{id:"getting-information"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-information"}},[e._v("#")]),e._v(" Getting information")]),e._v(" "),s("p",[e._v("You can retrieve some information about the current configuration using the command "),s("code",[e._v("info")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo info\n")])])]),s("h3",{attrs:{id:"deploy-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-the-services"}},[e._v("#")]),e._v(" Deploy the services")]),e._v(" "),s("p",[e._v("You can either deploy a given stack or deploy all the stacks.")]),e._v(" "),s("ul",[s("li",[e._v("Deploy a stack")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo deploy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("stack"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("ul",[s("li",[e._v("Deploy all the stacks")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./deploy deploy all\n")])])]),s("h3",{attrs:{id:"remove-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remove-the-services"}},[e._v("#")]),e._v(" Remove the services")]),e._v(" "),s("p",[e._v("You can either remove a given stack or remove all the stacks.")]),e._v(" "),s("ul",[s("li",[e._v("Remove a stack")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./kargo remove "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("stack"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("ul",[s("li",[e._v("Remove all the stacks")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$./remove remove all\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);