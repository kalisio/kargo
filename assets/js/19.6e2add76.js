(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{231:function(e,t,a){"use strict";a.r(t);var r=a(19),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"extracting-openstreetmap-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extracting-openstreetmap-data"}},[e._v("#")]),e._v(" Extracting OpenStreetMap data ?")]),e._v(" "),a("p",[e._v("The generation is based on the "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenMapTiles"),a("OutboundLink")],1),e._v(" project toolbox.")]),e._v(" "),a("p",[e._v("To generate OSM data we start from a fresh Scaleway server with a Docker image, it already contains docker, git, pip, gcc, etc.")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("Git clone using HTTPS instead of git protocol on Scaleway.")])]),e._v(" "),a("p",[e._v("Because you will need a lot of storage here is "),a("a",{attrs:{href:"https://www.scaleway.com/docs/attach-and-detach-a-volume-to-an-existing-server/",target:"_blank",rel:"noopener noreferrer"}},[e._v("how to add a volume"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$mkfs")]),e._v(" -t ext4 /dev/nbd1\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$mkdir")]),e._v(" -p /mnt/data\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$mount")]),e._v(" /dev/nbd1 /mnt/data\n")])])]),a("p",[e._v("To automount it: https://community.online.net/t/automatic-mounting-of-additional-volumes-using-systemd-on-ubuntu/3102")]),e._v(" "),a("p",[e._v("Because some data (eg PG data) are generated in docker volumes it is necessary to "),a("a",{attrs:{href:"https://forums.docker.com/t/how-do-i-change-the-docker-image-installation-directory/1169",target:"_blank",rel:"noopener noreferrer"}},[e._v("change the default docker location to your volumes"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Rendering the whole planet is a "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles/issues/242",target:"_blank",rel:"noopener noreferrer"}},[e._v("tricky thing"),a("OutboundLink")],1),e._v(", so for now we prefer to:")]),e._v(" "),a("ul",[a("li",[e._v("contribute with a Pull Request to the community maintained open-source official vector tile schema so that the changes will be part of the future public OpenMapTiles releases and maintained")]),e._v(" "),a("li",[e._v("render only the features needed into a separate MBTiles files with new layers - and combine the standard planet with the extra layers - this is doable easily with JSON GL style and software stack powered by "),a("a",{attrs:{href:"https://mapnik.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("mapnik"),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://github.com/mapbox/tippecanoe",target:"_blank",rel:"noopener noreferrer"}},[e._v("tippecanoe"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[e._v("the extra layers can be also generated on demand directly from PostGIS by a third party tile servers and combined into a single map with TileServer GL - and served via composed vector tiles or raster tiles\n"),a("ul",[a("li",[a("a",{attrs:{href:"http://geoserver.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("GeoServer"),a("OutboundLink")],1),e._v(" as vector/raster tiles")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/terranodo/tegola",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tegola"),a("OutboundLink")],1),e._v(" directly as MVT")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/t-rex-tileserver/t-rex",target:"_blank",rel:"noopener noreferrer"}},[e._v("T-Rex"),a("OutboundLink")],1),e._v(" directly as MVT")])])])]),e._v(" "),a("h2",{attrs:{id:"small-extracts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#small-extracts"}},[e._v("#")]),e._v(" Small extracts")]),e._v(" "),a("p",[e._v("For small extractions it's possible to use the "),a("a",{attrs:{href:"http://overpass-turbo.eu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OverPass API"),a("OutboundLink")],1),e._v(", eg to extract taxiways/runways in a zone:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[out:json][timeout:25];\n// gather results\n(\n  // query part for: “aeroway=runway”\n  node["aeroway"="runway"]({{bbox}});\n  way["aeroway"="runway"]({{bbox}});\n  relation["aeroway"="runway"]({{bbox}});\n  // query part for: “aeroway=taxiway”\n  node["aeroway"="taxiway"]({{bbox}});\n  way["aeroway"="taxiway"]({{bbox}});\n  relation["aeroway"="taxiway"]({{bbox}});\n);\n// print results\nout body;\n>;\nout skel qt;\n')])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("Our "),a("a",{attrs:{href:"https://kalisio.github.io/krawler/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Krawler"),a("OutboundLink")],1),e._v(" solution provides an efficient way to perform an Overpass query and get the result as a GeoJSON collection.")])]),e._v(" "),a("p",[e._v("We also use the "),a("a",{attrs:{href:"https://github.com/openmaptiles/openmaptiles/blob/master/QUICKSTART.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("quickstart script"),a("OutboundLink")],1),e._v(" to generate data (the link contains useful information about required architecture/sizing):")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$git")]),e._v(" clone https://github.com/openmaptiles/openmaptiles\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$cd")]),e._v(" openmaptiles\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$make")]),e._v("\n$./quickstart.sh france "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[e._v("2")]),e._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[e._v("&1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v(" // could be country, region, etc. but not planet\n")])])]),a("h2",{attrs:{id:"global-extracts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#global-extracts"}},[e._v("#")]),e._v(" Global extracts")]),e._v(" "),a("p",[e._v("For a layer covering the planet first download the "),a("a",{attrs:{href:"https://planet.openstreetmap.org/pbf/",target:"_blank",rel:"noopener noreferrer"}},[e._v("whole planet"),a("OutboundLink")],1),e._v(" in the "),a("em",[e._v("data")]),e._v(" directory and launch the process:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$cd")]),e._v(" data\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$wget")]),e._v(" https://planet.openstreetmap.org/pbf/planet-latest.osm.pbf\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$mv")]),e._v(" planet-latest.osm.pbf planet.osm.pbf\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$cd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("\n$./quickstart.sh planet "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[e._v("2")]),e._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[e._v("&1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("\n// To see result\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$docker")]),e._v(" run -it --rm -v /mnt/data/openmaptiles/data:/data -p "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":80 klokantech/tileserver-gl\n")])])]),a("p",[e._v("Using a Scaleway C2L configuration (€23.99/month, €0.048/hour, 8 Dedicated X86 64bit Cores, 32GB memory, 250GB Direct SSD, 800Mbit/s Unmetered) processing the "),a("code",[e._v("aeroway")]),e._v(" layer on the planet takes ~ 16 000 s and 120 GB.")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("Launching the script against the same data set again does not seem to correctly update the generation configuration.")])]),e._v(" "),a("p",[e._v("You should clean everything before relaunching:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$make")]),e._v(" clean-docker\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$make")]),e._v(" forced-clean-sql\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$rm")]),e._v(" -fr data build\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$make")]),e._v("\n")])])]),a("h2",{attrs:{id:"useful-links"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#useful-links"}},[e._v("#")]),e._v(" Useful links")]),e._v(" "),a("p",[e._v("Here is a list of interesting documentation:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://eprints.hsr.ch/536/1/thesis_updatable_vector_tiles_from_openstreetmap.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kloklantech thesis"),a("OutboundLink")],1),e._v(" detailing the whole toolchain")]),e._v(" "),a("li",[a("a",{attrs:{href:"http://fuzzytolerance.info/blog/2017/04/25/Generating-your-own-OpenMapTiles/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tutorial video"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=D7mmXonFIqA&feature=youtu.be",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mapbox presentation"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=s.exports}}]);