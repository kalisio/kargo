(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{171:function(t,s,e){t.exports=e.p+"assets/img/kargo-gateway.293e1ae6.svg"},175:function(t,s,e){"use strict";e.r(s);var a=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"advanced-usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#advanced-usage","aria-hidden":"true"}},[this._v("#")]),this._v(" Advanced usage")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"using-the-api-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-the-api-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Using the API Gateway")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuring-the-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuring the gateway")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"defining-the-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Defining the gateway")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[this._v("create a "),s("code",[this._v("gateway.config.yml")]),this._v(" file in the "),s("code",[this._v("configs\\express-gateway")]),this._v(" directory of your workspace")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(171),alt:"kargo-gateway"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("http:\n  port: 8080\nadmin:\n  port: 9876\n  host: localhost\napiEndpoints:\n  admin:\n    host: 'express-gateway'\n  wms:\n    host: '*'\n    paths: '/wms*'\n    scopes: [\"wms\"]\n  wmts:\n    host: '*'\n    paths: '/wmts/*'\n    scopes: [\"wmts\"] \n  k2:\n    host: '*'\n    paths: '/k2/*'\n    scopes: [\"k2\"]\n\nserviceEndpoints:\n  admin: \n    url: 'http://localhost:9876'\n  wms:\n    url: 'http://mapproxy:8080'\n  wmts:\n    url: 'http://mapproxy:8080/wmts'      \n  k2:\n    url: 'http://k2:8080' \n\npolicies:\n  - cors\n  - proxy\n\npipelines:\n  admin:\n    apiEndpoints:\n      - admin\n    policies:\n      - proxy:\n          - action:\n              serviceEndpoint: admin\n              changeOrigin: true\n              stripPath: true\n  wms:\n    apiEndpoints:\n      - wms\n    policies:            \n      - cors:\n      - proxy:\n          - action:\n              serviceEndpoint: wms \n              changeOrigin: true\n              stripPath: true       \n  wmts:\n    apiEndpoints:\n      - wmts\n    policies:           \n      - cors:\n      - proxy:\n          - action:\n              serviceEndpoint: wmts \n              changeOrigin: true\n              stripPath: true                            \n\n  k2:\n    apiEndpoints:\n      - k2\n    policies:              \n      - cors:\n      - proxy:\n          - action:\n              serviceEndpoint: k2\n              changeOrigin: true\n              stripPath: true\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("Kargo")]),this._v(" comes with various plugins that extends the "),s("strong",[this._v("express-gateway")]),this._v(" capabilities:")])},function(){var t=this.$createElement,s=this._self._c||t;return s("thead",[s("tr",[s("th",[this._v("Plugin")]),this._v(" "),s("th",[this._v("Description")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("tr",[s("td",[s("strong",[this._v("populate")])]),this._v(" "),s("td",[this._v("It populates the gateway according the "),s("code",[this._v("consumers.config.js")]),this._v(" file.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("tr",[s("td",[s("strong",[this._v("scopes")])]),this._v(" "),s("td",[this._v("It provides a "),s("strong",[this._v("policy")]),this._v(" that can be used to check the consumer scopes against the endpoint scopes.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("td",[s("strong",[this._v("metrics")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("tr",[e("td",[e("strong",[t._v("s3")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("s3")]),t._v(" route to the admin application that can be uses to proxy the requests to an "),e("strong",[t._v("S3")]),t._v(" bucket. The service endpoint to be used is: "),e("code",[t._v("http://localhost:9876/s3")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("tr",[e("td",[e("strong",[t._v("healthcheck")])]),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("healthcheck")]),t._v(" route to be used to check the health of "),e("strong",[t._v("express gateway")]),t._v(". "),e("strong",[t._v("Kargo")]),t._v(" uses this route to ensure the healthcheck of the service.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"defining-the-consumers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-consumers","aria-hidden":"true"}},[this._v("#")]),this._v(" Defining the consumers")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("create a "),s("code",[this._v("consumers.config.json")]),this._v(" file in the "),s("code",[this._v("configs\\express-gateway")]),this._v(" directory of your workspace")]),this._v(" "),s("li",[this._v("edit the file and define your consumers using the following formalism:")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  scopes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  users"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cutomer1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      qgis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'basic-auth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          password"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PASSWORD>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      leafet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customer2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      kano"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"running-the-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#running-the-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Running the gateway")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("define a stack with the "),s("code",[this._v("express-gateway")]),this._v(" service")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# do not forget to declare the stack in STACKS")]),this._v("\nAPI_STACK"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[this._v('"express-gateway"')]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("configure "),s("strong",[this._v("Kargo")]),this._v(":")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$./kargo configure kargo\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("build the "),s("strong",[this._v("express gateway")]),this._v(" docker image:")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$./kargo build express-gateway\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("deploy the stack")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$./kargo deploy api\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),s("p",[s("strong",[this._v("Kargo")]),this._v(" used the "),s("code",[this._v("populate")]),this._v(" plugin to automatically populate the gateway at startup.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"managing-the-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#managing-the-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Managing the gateway")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" -ti "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("express-gateway-container-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sh\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v(" list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kalisio"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("eg apps list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kano"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms,wmts,wfs,wcs,s3"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg credentials list\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consumerId"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3d981c1b-b0af-4139-a2ca-e304a4f018a6"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wfs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wcs"')]),t._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" true,\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyId"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keySecret"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SECRET"')]),t._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jwt"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"extending-the-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extending-the-services","aria-hidden":"true"}},[this._v("#")]),this._v(" Extending the services")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("Kargo")]),this._v(" allows you to extend the default services settings for a given cluster. You can either overwrite the default settings files of a service or extend the way the service will be deployed (specify the healthcheck, add some constraints...)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("For this you must create a directory structure in your workspace similar to that of "),s("strong",[this._v("Kargo")]),this._v(" where you will put your stuff.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("For instance, if we have 2 services, "),s("code",[this._v("service-1")]),this._v(" and "),s("code",[this._v("service-2")]),this._v(", and we want to:")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("overwrite the configuration of "),s("code",[this._v("service-1")]),this._v(" as well as extend the its deployment method.")]),this._v(" "),s("li",[this._v("overwrite the configuration of "),s("code",[this._v("service-2")]),this._v(" only.")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ deploy\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yml   the yml extension you want to apply when deployin the service-1\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ configs\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-1 you need to overwrite \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-2"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-2 you need to overwrite \n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("When extending the deployment method of a service, you must tell "),e("strong",[t._v("Kargo")]),t._v(" which file to add when deploying the service.\nFor each service, you need to declare a variable in the "),e("code",[t._v(".env")]),t._v(" file which tell the name of the "),e("code",[t._v("yml")]),t._v(" file to take into account. In the previous example, the entry in the "),e("code",[t._v(".env")]),t._v(" file should look like:")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SERVICE-1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("_EXTENSION"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])}],n=e(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),e("p",[t._v("As a reminder, an API gateway allows you to map endpoints to a set of services or applications using url rules. Moreover it is possible to protect those endpoints using various authorization strategies ("),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Key_authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("Key authentication"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON Web Tokens"),e("OutboundLink")],1),t._v(", "),e("a",{attrs:{href:"https://oauth.net/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth"),e("OutboundLink")],1),t._v("...) and defining quotas and rate limiting. To enable such a features "),e("strong",[t._v("Kargo")]),t._v(" relies on "),e("a",{attrs:{href:"https://www.express-gateway.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express gateway"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("We recommend that you read the "),e("strong",[t._v("express gateway")]),t._v(" "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),e("OutboundLink")],1),t._v(" before starting.")])]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[e("strong",[t._v("express gateway")]),t._v(" relies on "),e("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),e("OutboundLink")],1),t._v(" to store the consumers data. In order to check your configuration, "),e("a",{attrs:{href:"https://joeferner.github.io/redis-commander/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Commander"),e("OutboundLink")],1),t._v(" is a convenient solution to explore the "),e("strong",[t._v("Redis")]),t._v(" data store. These 2 applications are easily deployable with "),e("strong",[t._v("Kargo")])])]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("To define you gateway, you simply need to:")]),t._v(" "),e("ol",[t._m(4),t._v(" "),e("li",[t._v("edit the file and define your gateway. Check the documentation "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/configuration/gateway.config.yml/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("Here is an example of gateway implementing the mapping illustrated by the following schema:")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),e("table",[t._m(8),t._v(" "),e("tbody",[t._m(9),t._v(" "),t._m(10),t._v(" "),e("tr",[t._m(11),t._v(" "),e("td",[t._v("It provides a "),e("code",[t._v("metrics")]),t._v(" route to the gateway application that can be used by "),e("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),e("OutboundLink")],1),t._v(" to scrape requests metrics.")])]),t._v(" "),t._m(12),t._v(" "),t._m(13)])]),t._v(" "),t._m(14),t._v(" "),e("p",[t._v("Once the gateway is implemented and started, it is necessary to define the consumers.")]),t._v(" "),t._m(15),t._v(" "),t._m(16),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Refer to the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/consumer-management/",target:"_blank",rel:"noopener noreferrer"}},[t._v("consumer-management"),e("OutboundLink")],1),t._v(" section to learn mode about "),e("code",[t._v("keyId")]),t._v(" and "),e("code",[t._v("keySecret")]),t._v(".")])]),t._v(" "),t._m(17),t._v(" "),e("p",[t._v("You must simply execute the following procedure:")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._v(" "),e("p",[e("strong",[t._v("Kargo")]),t._v(" rely on the "),e("a",{attrs:{href:"https://www.express-gateway.io/docs/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express-gateway cli"),e("OutboundLink")],1),t._v(" to manage the gateway:")]),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),e("p",[t._v("Then, the directory structure will look like:")]),t._v(" "),t._m(34),t._m(35),t._v(" "),t._m(36),e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Before deploying, do not forget to make the "),e("strong",[t._v("merged configuration")]),t._v(" using the "),e("router-link",{attrs:{to:"./../reference/cli.html#configure"}},[t._v("configure")]),t._v(" command.")],1)])])},a,!1,null,null,null);r.options.__file="advanced-usage.md";s.default=r.exports}}]);