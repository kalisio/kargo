(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{389:function(t,e,s){"use strict";s.r(e);var a=s(27),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"using-mongodb-atlas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-mongodb-atlas"}},[t._v("#")]),t._v(" Using MongoDB Atlas")]),t._v(" "),s("p",[t._v("In a critical operational context, it can be safer to rely on "),s("a",{attrs:{href:"https://www.mongodb.com/cloud/atlas",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB Atlas"),s("OutboundLink")],1),t._v(" than on your own instance of MongoDB.")]),t._v(" "),s("p",[t._v("To use "),s("strong",[t._v("MongoDB Atlas")]),t._v(" with "),s("strong",[t._v("Kargo")]),t._v(", there are few things to do:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Create your cluster on "),s("strong",[t._v("MongoDB Atlas")])])]),t._v(" "),s("li",[s("p",[t._v("Enables the connection from "),s("strong",[t._v("Kargo")]),t._v(" to your cluster. On "),s("strong",[t._v("AWS")]),t._v(" the best practice is to enable a peering connection between your "),s("strong",[t._v("Kargo")]),t._v(" VPC and your cluster VPC. See the "),s("a",{attrs:{href:"https://docs.atlas.mongodb.com/security-vpc-peering/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),s("OutboundLink")],1),t._v(" for the detailed procedure.")])]),t._v(" "),s("li",[s("p",[t._v("Configure the services in "),s("strong",[t._v("Kargo")]),t._v(" to use "),s("strong",[t._v("MongoDB Atlas")]),t._v(".")])])]),t._v(" "),s("p",[t._v("The tricky thing is that you will need to configure the services with the appropriate connection string. Indeed, the connection string provided by "),s("strong",[t._v("MongoDB Atlas")]),t._v(" is dependent from the MongoDB driver you use and for now "),s("strong",[t._v("Krawler")]),t._v(" based jobs are using the version 3 of the MongoDB driver while "),s("strong",[t._v("KDK")]),t._v(" based applications are using the version 2.")]),t._v(" "),s("p",[t._v("In your "),s("code",[t._v(".env")]),t._v(" file:")]),t._v(" "),s("ul",[s("li",[t._v("declare the following variables, with the connections strings provided by MongoDB Atlas:")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MONGO_ATLAS_URL_V2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://<user>:<password>@<cluster-name>-shard-00-00-<cluster-path>.mongodb.net:27017,<cluster-name>-shard-00-01-<cluster-path>.mongodb.net:27017,<cluster-name>-shard-00-02-<cluster-path>.mongodb.net:27017/kargo?ssl=true&replicaSet=Cluster0-shard-0&authSource=admin&retryWrites=true"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MONGO_ATLAS_URL_V3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb+srv://<user>:<password>@<cluster-name>-<cluster-path>.mongodb.net/kargo?retryWrites=true"')]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("To get the connection strings, click on the "),s("code",[t._v("CONNECT")]),t._v(" button attached to your cluster. Then select "),s("code",[t._v("Connect your application")]),t._v(" and a window will display the connection strings for the different version of the driver.")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Do not forget to quote the variables.")])]),t._v(" "),s("ul",[s("li",[t._v("update the DB URL variables for the services, for instance:")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("KANO_DB_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGO_ATLAS_URL_V2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VIGICRUES_DB_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGO_ATLAS_URL_V3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("WEACAST_DB_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGO_ATLAS_URL_V2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("WEACAST_LOADERS_DB_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGO_ATLAS_URL_V3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);