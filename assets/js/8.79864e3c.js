(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{504:function(t,s,e){t.exports=e.p+"assets/img/kargo-traefik.21ca1aa0.svg"},505:function(t,s,e){t.exports=e.p+"assets/img/kargo-gateway.293e1ae6.svg"},527:function(t,s,e){"use strict";e.r(s);var a=e(13),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"advanced-usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#advanced-usage"}},[t._v("#")]),t._v(" Advanced usage")]),t._v(" "),a("h2",{attrs:{id:"routing-the-traffic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#routing-the-traffic"}},[t._v("#")]),t._v(" Routing the traffic")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" relies on "),a("a",{attrs:{href:"https://containo.us/traefik/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik"),a("OutboundLink")],1),t._v(" to manage the incoming requests to the platform. "),a("strong",[t._v("Traefik")]),t._v(" is a reverse proxy and load balancer that help routes the incoming requests to the deployed services (backend) using so called "),a("a",{attrs:{href:"https://docs.traefik.io/v1.7/basics/#frontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("frontends"),a("OutboundLink")],1),t._v(". A frontend consists of a set of rules that determine how incoming requests are forwarded from an entry point to a backend.")]),t._v(" "),a("p",[a("img",{attrs:{src:e(504),alt:"kargo-traefik"}})]),t._v(" "),a("p",[t._v("By default "),a("strong",[t._v("Traefik")]),t._v(" is configured with 2 entry points:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("80")]),t._v(": this port ensures HTTP traffic. It is mainly used to enable "),a("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Let's Encrypt"),a("OutboundLink")],1),t._v(" ACME management. However, the port is redirected to the port "),a("code",[t._v("443")])]),t._v(" "),a("li",[a("code",[t._v("443")]),t._v(": this port ensures HTTPS traffic.")])]),t._v(" "),a("p",[t._v("The services provided by "),a("strong",[t._v("Kargo")]),t._v(" are already configured to be automatically discovered by "),a("strong",[t._v("Traefik")]),t._v(" once deployed. Sometimes you may need to override or extend this configuration. See the section "),a("a",{attrs:{href:"#extending-the-services"}},[t._v("extending the services")]),t._v(".")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" still uses the version "),a("code",[t._v("1.7")]),t._v(" of "),a("strong",[t._v("Traefik")]),t._v(". Check the documentation "),a("a",{attrs:{href:"https://docs.traefik.io/v1.7/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("When testing the your configuration, we highly recommend to use the "),a("strong",[t._v("staging")]),t._v(" mode provided by "),a("strong",[t._v("Let's Encrypt")]),t._v(" otherwise you may reach the "),a("a",{attrs:{href:"https://letsencrypt.org/docs/rate-limits/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rate limits"),a("OutboundLink")],1),t._v(".\nSetup the variable "),a("code",[t._v("TRAEFIK_ACME_SERVER")]),t._v(" with the following url "),a("code",[t._v("https://acme-staging-v02.api.letsencrypt.org/directory")])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("For security reason, "),a("strong",[t._v("Traefik")]),t._v(" relies on "),a("a",{attrs:{href:"https://github.com/Tecnativa/docker-socket-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-socket-proxy"),a("OutboundLink")],1),t._v(" to secure the access to the Docker socket. Read this "),a("a",{attrs:{href:"https://docs.traefik.io/providers/docker/#docker-api-access",target:"_blank",rel:"noopener noreferrer"}},[t._v("note"),a("OutboundLink")],1),t._v(" to learn more about this security concern.")])]),t._v(" "),a("h2",{attrs:{id:"using-the-api-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-the-api-gateway"}},[t._v("#")]),t._v(" Using the API Gateway")]),t._v(" "),a("p",[t._v("As a reminder, an API gateway allows you to map endpoints to a set of services or applications using url rules. Moreover it is possible to protect those endpoints using various authorization strategies ("),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Key_authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("Key authentication"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON Web Tokens"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://oauth.net/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth"),a("OutboundLink")],1),t._v("...) and defining quotas and rate limiting. To enable such a features "),a("strong",[t._v("Kargo")]),t._v(" relies on "),a("a",{attrs:{href:"https://www.express-gateway.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express gateway"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("We recommend that you read the "),a("strong",[t._v("express gateway")]),t._v(" "),a("a",{attrs:{href:"https://www.express-gateway.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),a("OutboundLink")],1),t._v(" before starting.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("strong",[t._v("express gateway")]),t._v(" relies on "),a("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),a("OutboundLink")],1),t._v(" to store the consumers data. In order to check your configuration, "),a("a",{attrs:{href:"https://joeferner.github.io/redis-commander/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Commander"),a("OutboundLink")],1),t._v(" is a convenient solution to explore the "),a("strong",[t._v("Redis")]),t._v(" data store. These 2 applications are easily deployable with "),a("strong",[t._v("Kargo")])])]),t._v(" "),a("h3",{attrs:{id:"configuring-the-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-gateway"}},[t._v("#")]),t._v(" Configuring the gateway")]),t._v(" "),a("h4",{attrs:{id:"defining-the-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-gateway"}},[t._v("#")]),t._v(" Defining the gateway")]),t._v(" "),a("p",[t._v("To define you gateway, you simply need to:")]),t._v(" "),a("ol",[a("li",[t._v("create a "),a("code",[t._v("gateway.config.yml")]),t._v(" file in the "),a("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),a("li",[t._v("edit the file and define your gateway. Check the documentation "),a("a",{attrs:{href:"https://www.express-gateway.io/docs/configuration/gateway.config.yml/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("Here is an example of gateway implementing the mapping illustrated by the following schema:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(505),alt:"kargo-gateway"}})]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express-gateway'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wms*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/wmts/*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/k2/*'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scopes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:9876'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mapproxy:8080/wmts'")]),t._v("      \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://k2:8080'")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cors\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pipelines")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" admin\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wms\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wms \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("       \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("wmts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wmts\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("           \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wmts \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("                            \n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiEndpoints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" k2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("              \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k2\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stripPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[a("strong",[t._v("Kargo")]),t._v(" comes with various plugins that extends the "),a("strong",[t._v("express-gateway")]),t._v(" capabilities:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Plugin")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("populate")])]),t._v(" "),a("td",[t._v("It populates the gateway according the "),a("code",[t._v("consumers.config.js")]),t._v(" file.")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("scopes")])]),t._v(" "),a("td",[t._v("It provides a "),a("strong",[t._v("policy")]),t._v(" that can be used to check the consumer scopes against the endpoint scopes.")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("metrics")])]),t._v(" "),a("td",[t._v("It provides a "),a("code",[t._v("metrics")]),t._v(" route to the gateway application that can be used by "),a("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),a("OutboundLink")],1),t._v(" to scrape requests metrics.")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("s3")])]),t._v(" "),a("td",[t._v("It provides a "),a("code",[t._v("s3")]),t._v(" route to the admin application that can be uses to proxy the requests to an "),a("strong",[t._v("S3")]),t._v(" bucket. The service endpoint to be used is: "),a("code",[t._v("http://localhost:9876/s3")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("healthcheck")])]),t._v(" "),a("td",[t._v("It provides a "),a("code",[t._v("healthcheck")]),t._v(" route to be used to check the health of "),a("strong",[t._v("express gateway")]),t._v(". "),a("strong",[t._v("Kargo")]),t._v(" uses this route to ensure the healthcheck of the service.")])])])]),t._v(" "),a("h4",{attrs:{id:"defining-the-consumers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defining-the-consumers"}},[t._v("#")]),t._v(" Defining the consumers")]),t._v(" "),a("p",[t._v("Once the gateway is implemented and started, it is necessary to define the consumers.")]),t._v(" "),a("ol",[a("li",[t._v("create a "),a("code",[t._v("consumers.config.js")]),t._v(" file in the "),a("code",[t._v("configs\\express-gateway")]),t._v(" directory of your workspace")]),t._v(" "),a("li",[t._v("edit the file and define your consumers using the following formalism:")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  scopes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  users"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cutomer1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      qgis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'basic-auth'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PASSWORD>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      leafet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_SECRET>'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      kano"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapserver'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    customer2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      kano"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        scopes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mapproxy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        credential"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          keyId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<KEY_ID>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n          keySecret"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<APP_SECRET>'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("Refer to the "),a("a",{attrs:{href:"https://www.express-gateway.io/docs/consumer-management/",target:"_blank",rel:"noopener noreferrer"}},[t._v("consumer-management"),a("OutboundLink")],1),t._v(" section to learn mode about "),a("code",[t._v("keyId")]),t._v(" and "),a("code",[t._v("keySecret")]),t._v(".")])]),t._v(" "),a("h4",{attrs:{id:"running-the-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-the-gateway"}},[t._v("#")]),t._v(" Running the gateway")]),t._v(" "),a("p",[t._v("You must simply execute the following procedure:")]),t._v(" "),a("ol",[a("li",[t._v("define a stack with the "),a("code",[t._v("express-gateway")]),t._v(" service")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not forget to declare the stack in STACKS")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("API_STACK")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express-gateway"')]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("configure "),a("strong",[t._v("Kargo")]),t._v(":")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$./kargo configure kargo\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("build the "),a("strong",[t._v("express gateway")]),t._v(" docker image:")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$./kargo build express-gateway\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("deploy the stack")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$./kargo deploy api\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" used the "),a("code",[t._v("populate")]),t._v(" plugin to automatically populate the gateway at startup.")])]),t._v(" "),a("h3",{attrs:{id:"managing-the-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#managing-the-gateway"}},[t._v("#")]),t._v(" Managing the gateway")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" relies on the "),a("a",{attrs:{href:"https://www.express-gateway.io/docs/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("express-gateway cli"),a("OutboundLink")],1),t._v(" to manage the gateway:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -ti "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("express-gateway-container-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v(" list\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kalisio"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("eg apps list\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"64760494-f8d7-4f1b-b845-f56f6dde5c07"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kano"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms,wmts,wfs,wcs,s3"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" eg credentials list\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consumerId"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"977223ed-a3e8-4305-9b12-322a67ba5b83"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3d981c1b-b0af-4139-a2ca-e304a4f018a6"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createdAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mon Dec 02 2019 14:52:56 GMT+0000 (Coordinated Universal Time)"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scopes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wms"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wmts"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wfs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wcs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isActive"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyId"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keySecret"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SECRET"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jwt"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"configuring-proxy-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-proxy-settings"}},[t._v("#")]),t._v(" Configuring proxy settings")]),t._v(" "),a("p",[t._v("When you choose an on-premises deployment, it may be necessary to configure "),a("strong",[t._v("Kargo")]),t._v(" to use the corporate proxy server.\nTo use a proxy, you can set the environment variables "),a("code",[t._v("HTTP_PROXY")]),t._v(", "),a("code",[t._v("HTTPS_PROXY")]),t._v(", "),a("code",[t._v("FTP_PROXY")]),t._v(" and "),a("code",[t._v("NO_PROXY")]),t._v(".")]),t._v(" "),a("p",[t._v("Depending on the traffic type, set the required variables in your "),a("code",[t._v(".env")]),t._v(" file:")]),t._v(" "),a("div",{staticClass:"language-env extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('HTTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nHTTPS_PROXY="https://USER:PASSWORD@PROXY_SERVER:PORT"\nFTP_PROXY="http://USER:PASSWORD@PROXY_SERVER:PORT"\nNO_PROXY="localhost"\n')])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("NO_PROXY")]),t._v(" must at least contain the value "),a("code",[t._v("localhost")]),t._v(" to let the Krawler jobs healthcheck work correctly.")])]),t._v(" "),a("h2",{attrs:{id:"using-mongors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-mongors"}},[t._v("#")]),t._v(" Using Mongors")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" provides a "),a("RouterLink",{attrs:{to:"/reference/environment.html#mongors"}},[t._v("Mongors")]),t._v(" service that can help you setting up a "),a("a",{attrs:{href:"https://docs.mongodb.com/manual/replication/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB Replica Set"),a("OutboundLink")],1),t._v(". It creates 3 "),a("strong",[t._v("MongoDB")]),t._v(" instances, "),a("code",[t._v("mongodb0")]),t._v(", "),a("code",[t._v("mongodb1")]),t._v(" and "),a("code",[t._v("mongodb2")]),t._v(", configured to be used as a "),a("strong",[t._v("Replica Set")]),t._v(" named "),a("code",[t._v("mongors")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"setting-up-the-replica-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-replica-set"}},[t._v("#")]),t._v(" Setting up the Replica Set")]),t._v(" "),a("p",[t._v("Execute the following procedure")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("You first need to assign a constraint label on the nodes where you want to deploy the "),a("strong",[t._v("MongoDB")]),t._v(" instances.")])]),t._v(" "),a("li",[a("p",[t._v("Declare the service "),a("strong",[t._v("mongors")]),t._v(" within a stack of your choice. We recommend to use a dedicated stack.")])]),t._v(" "),a("li",[a("p",[t._v("Deploy the stack and therefore the service")])]),t._v(" "),a("li",[a("p",[t._v("Start a session on the "),a("strong",[t._v("Primary")]),t._v(" container:")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -ti "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("constainer_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/deploy-replica-set/#initiate-the-replica-set",target:"_blank",rel:"noopener noreferrer"}},[t._v("Initiate"),a("OutboundLink")],1),t._v(" the "),a("strong",[t._v("Replica Set")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'rs.initiate({ _id: "mongors", version: 1, members: [ { _id: 0, host : "mongors0:27017" }, { _id: 1, host : "mongors1:27017" }, { _id: 2, host : "mongors2:27017" } ] })\'')]),t._v("\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/core/replica-set-oplog/#workloads-that-might-require-a-larger-oplog-size",target:"_blank",rel:"noopener noreferrer"}},[t._v("Maybe define a bigger OpLog size"),a("OutboundLink")],1),t._v(". You'll need to run this on all replica set members that may become primary.")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors1 --eval "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors2 --eval "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.adminCommand({replSetResizeOplog: 1, size: 51200})'")]),t._v("\n")])])]),a("ol",{attrs:{start:"7"}},[a("li",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/troubleshoot-replica-sets/#check-replica-set-status",target:"_blank",rel:"noopener noreferrer"}},[t._v("Check the status"),a("OutboundLink")],1),t._v(" of the "),a("strong",[t._v("Replica Set")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mongo")]),t._v(" --host mongors0 --eval "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rs.status()'")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("You can override the name of the "),a("strong",[t._v("Replica Set")]),t._v(" (as well as the "),a("strong",[t._v("MongoDB")]),t._v(" instances) by setting the "),a("code",[t._v("MONGORS_NAME")]),t._v(" variable. By default the "),a("strong",[t._v("Replica Set")]),t._v(" is named "),a("code",[t._v("mongors")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"troubleshooting-the-replica-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-the-replica-set"}},[t._v("#")]),t._v(" Troubleshooting the Replica Set")]),t._v(" "),a("p",[t._v("A member of a replica set could enter "),a("code",[t._v("RECOVERING")]),t._v(" state when it is not ready to accept reads.\nTo restore the instance in a core state, you may want to turn off the container, remove the volume and restart the container. The member will begin an initial sync and remain in "),a("code",[t._v("STARTUP2")]),t._v(" state. Afterwards, the member will transit to  "),a("code",[t._v("RECOVERING")]),t._v(" state and then its core state.")]),t._v(" "),a("h2",{attrs:{id:"extending-the-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extending-the-services"}},[t._v("#")]),t._v(" Extending the services")]),t._v(" "),a("p",[a("strong",[t._v("Kargo")]),t._v(" allows you to extend the default services settings for a given cluster. You can either overwrite the default settings files of a service or extend the way the service will be deployed (specify the healthcheck, add some constraints...)")]),t._v(" "),a("p",[t._v("For this you must create a directory structure in your workspace similar to that of "),a("strong",[t._v("Kargo")]),t._v(" where you will put your stuff.")]),t._v(" "),a("p",[t._v("For instance, if we have 2 services, "),a("code",[t._v("service-1")]),t._v(" and "),a("code",[t._v("service-2")]),t._v(", and we want to:")]),t._v(" "),a("ul",[a("li",[t._v("overwrite the configuration of "),a("code",[t._v("service-1")]),t._v(" as well as extend the its deployment method.")]),t._v(" "),a("li",[t._v("overwrite the configuration of "),a("code",[t._v("service-2")]),t._v(" only.")])]),t._v(" "),a("p",[t._v("Then, the directory structure will look like:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ deploy\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yml   the yml extension you want to apply when deployin the service-1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ configs\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-1 you need to overwrite \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("         the settings files of the service-2 you need to overwrite \n")])])]),a("p",[t._v("When extending the deployment method of a service, you must tell "),a("strong",[t._v("Kargo")]),t._v(" which file to add when deploying the service.\nFor each service, you need to declare a variable in the "),a("code",[t._v(".env")]),t._v(" file which tell the name of the "),a("code",[t._v("yml")]),t._v(" file to take into account. In the previous example, the entry in the "),a("code",[t._v(".env")]),t._v(" file should look like:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SERVICE-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("_EXTENSION"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("1")]),t._v(">")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("Before deploying, do not forget to make the "),a("strong",[t._v("merged configuration")]),t._v(" using the "),a("RouterLink",{attrs:{to:"/reference/cli.html#configure"}},[t._v("configure")]),t._v(" command.")],1)]),t._v(" "),a("h2",{attrs:{id:"using-placement-constraints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-placement-constraints"}},[t._v("#")]),t._v(" Using placement constraints")]),t._v(" "),a("p",[t._v("For each service defined there's a "),a("code",[t._v("$(NAME_OF_SERVICE)_CONSTRAINTS")]),t._v(" variable that you can define to specify placement constraints. The content of these variable should follow the "),a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-constraints---constraint",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker service constraints syntax"),a("OutboundLink")],1),t._v(". Spaces are not allowed in the variable content, except to specify multiple constraints, in which case space is used as a separator.")]),t._v(" "),a("h2",{attrs:{id:"using-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-hooks"}},[t._v("#")]),t._v(" Using hooks")]),t._v(" "),a("p",[t._v("Sometimes, it may be useful to execute some scripts before or after a service is deployed. This is the purpose of the hooks.\nTo declare a before or an after hook, create a script in the "),a("code",[t._v("deploy")]),t._v(" folder named "),a("code",[t._v("<service>_before.sh")]),t._v(" or "),a("code",[t._v("<service>_after.sh")]),t._v(".\nThe script will automatically executed when deploying the service.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("Note that "),a("code",[t._v("after")]),t._v(" hooks are executed once the complete stack is deployed.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);