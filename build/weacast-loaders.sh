#!/bin/bash
for WEACAST_MODEL in $WEACAST_MODELS; do
  WEACAST_LOADER_TAG_NAME=${WEACAST_MODEL^^}_LOADER_TAG
  WEACAST_LOADER_TAG_NAME=${WEACAST_LOADER_TAG_NAME//-/_}
  WEACAST_LOADER_TAG=${!WEACAST_LOADER_TAG_NAME}
  GIT_URL=https://github.com/weacast/weacast-loader.git
  GIT_BRANCH=$WEACAST_LOADER_TAG
  if [ "$GIT_BRANCH" != "latest" ]; then
    GIT_URL=$GIT_URL#$GIT_BRANCH
  fi
  docker build --build-arg TAG=$WEACAST_LOADER_TAG --build-arg SYNC_DB_URL=$WEACAST_DB_URL -f dockerfile.$WEACAST_MODEL -t $WEACAST_MODEL-loader:$WEACAST_LOADER_TAG $GIT_URL
  docker tag $WEACAST_MODEL-loader:$WEACAST_LOADER_TAG 127.0.0.1:5000/$WEACAST_MODEL-loader:$WEACAST_LOADER_TAG
  docker push 127.0.0.1:5000/$WEACAST_MODEL-loader:$WEACAST_LOADER_TAG
done
