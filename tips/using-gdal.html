<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using GDAL | Kargo</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kargo/kargo-icon-64x64.png">
    <link rel="manifest" href="/kargo/manifest.json">
    <meta name="description" content="A Docker based solution to deploy Geospatial Services">
    
    <link rel="preload" href="/kargo/assets/css/0.styles.5cd31058.css" as="style"><link rel="preload" href="/kargo/assets/js/app.6e8f31dd.js" as="script"><link rel="preload" href="/kargo/assets/js/3.f09f66f6.js" as="script"><link rel="preload" href="/kargo/assets/js/27.810f1a3e.js" as="script"><link rel="preload" href="/kargo/assets/js/4.5c2690c3.js" as="script"><link rel="prefetch" href="/kargo/assets/js/10.80e27cde.js"><link rel="prefetch" href="/kargo/assets/js/11.8402b5c3.js"><link rel="prefetch" href="/kargo/assets/js/12.a39d9573.js"><link rel="prefetch" href="/kargo/assets/js/13.3e18226b.js"><link rel="prefetch" href="/kargo/assets/js/14.d94d5659.js"><link rel="prefetch" href="/kargo/assets/js/15.c7477235.js"><link rel="prefetch" href="/kargo/assets/js/16.b3bcda79.js"><link rel="prefetch" href="/kargo/assets/js/17.b923da4c.js"><link rel="prefetch" href="/kargo/assets/js/18.c1aa1da1.js"><link rel="prefetch" href="/kargo/assets/js/19.7ea57692.js"><link rel="prefetch" href="/kargo/assets/js/2.7cc61a80.js"><link rel="prefetch" href="/kargo/assets/js/20.d443ff4d.js"><link rel="prefetch" href="/kargo/assets/js/21.7edf6010.js"><link rel="prefetch" href="/kargo/assets/js/22.0641f1a9.js"><link rel="prefetch" href="/kargo/assets/js/23.db3747c6.js"><link rel="prefetch" href="/kargo/assets/js/24.2d863ecb.js"><link rel="prefetch" href="/kargo/assets/js/25.67d28038.js"><link rel="prefetch" href="/kargo/assets/js/26.e584bc44.js"><link rel="prefetch" href="/kargo/assets/js/28.fd6ed499.js"><link rel="prefetch" href="/kargo/assets/js/29.2e20d60e.js"><link rel="prefetch" href="/kargo/assets/js/30.6482f5a7.js"><link rel="prefetch" href="/kargo/assets/js/31.f0b17086.js"><link rel="prefetch" href="/kargo/assets/js/32.59be9be9.js"><link rel="prefetch" href="/kargo/assets/js/33.0c30461c.js"><link rel="prefetch" href="/kargo/assets/js/5.59564082.js"><link rel="prefetch" href="/kargo/assets/js/6.208b90d5.js"><link rel="prefetch" href="/kargo/assets/js/7.65777dff.js"><link rel="prefetch" href="/kargo/assets/js/8.464a4e68.js"><link rel="prefetch" href="/kargo/assets/js/9.09ad2f39.js">
    <link rel="stylesheet" href="/kargo/assets/css/0.styles.5cd31058.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kargo/" class="home-link router-link-active"><!----> <span class="site-name">Kargo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kargo/tips/using-gdal.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kargo/tips/using-gdal.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/kargo/tips/using-private-registry.html" class="sidebar-link">Using a private registry</a></li><li><a href="/kargo/tips/using-gdal.html" aria-current="page" class="active sidebar-link">Using GDAL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kargo/tips/using-gdal.html#basic-usage" class="sidebar-link">Basic usage</a></li><li class="sidebar-sub-header"><a href="/kargo/tips/using-gdal.html#use-cases" class="sidebar-link">Use cases</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kargo/tips/using-gdal.html#how-to-post-process-an-mbtiles-file" class="sidebar-link">How to post process an MBTiles file ?</a></li><li class="sidebar-sub-header"><a href="/kargo/tips/using-gdal.html#how-to-create-a-tile-index-from-an-s3-mosaic" class="sidebar-link">How to create a tile index from an S3 mosaic ?</a></li></ul></li></ul></li><li><a href="/kargo/tips/using-artillery.html" class="sidebar-link">Using Artillery</a></li><li><a href="/kargo/tips/handling-long-running-process.html" class="sidebar-link">Handling long-running process</a></li><li><a href="/kargo/tips/using-mongodb-atlas.html" class="sidebar-link">Using MongoDB Atlas</a></li><li><a href="/kargo/tips/extracting-osm-data.html" class="sidebar-link">Extracting OpenStreetMap data</a></li><li><a href="/kargo/tips/running-express-gateway.html" class="sidebar-link">Running express-gateway locally</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-gdal"><a href="#using-gdal" class="header-anchor">#</a> Using GDAL</h1> <p><strong>Kargo</strong> provides a <a href="https://www.gdal.org/index.html" target="_blank" rel="noopener noreferrer">GDAL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> docker image shipped with a set of additional tools:</p> <ul><li><a href="https://www.imagemagick.org/" target="_blank" rel="noopener noreferrer">ImageMagick<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/icetan/sqlitepipe" target="_blank" rel="noopener noreferrer">sqlitepipe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The <strong>GDAL</strong> image extends the official <a href="https://hub.docker.com/r/osgeo/gdal" target="_blank" rel="noopener noreferrer">OSGEO image<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h2 id="basic-usage"><a href="#basic-usage" class="header-anchor">#</a> Basic usage</h2> <p>Simply run the following command on a given worker node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run  -v /path/to/your/data:/data -t -i kalisio/gdal:3.4.0 /bin/bash
<span class="token variable">$cd</span> /data
<span class="token variable">$gdalinfo</span> path/to/my/dataset
</code></pre></div><p>If you need to access another container you will need to run the GDAL container within the same network. For instance, the following command will allow you to link the GDAL container to an existing <code>Postgis</code> container in the network <code>kargo</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run --network<span class="token operator">=</span>kargo  -v /mnt/data:/data -t -i kalisio/gdal:3.4.0 /bin/bash
</code></pre></div><p>If you need to use the AWS CLI, you may need to share your credentials:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run  -v /path/to/your/data:/data /home/ubuntu/.aws:/root/.aws -t -i kalisio/gdal:latest /bin/bash
</code></pre></div><h2 id="use-cases"><a href="#use-cases" class="header-anchor">#</a> Use cases</h2> <h3 id="how-to-post-process-an-mbtiles-file"><a href="#how-to-post-process-an-mbtiles-file" class="header-anchor">#</a> How to post process an MBTiles file ?</h3> <p>The <strong>gdal</strong> image comes with the <a href="https://github.com/icetan/sqlitepipe" target="_blank" rel="noopener noreferrer">sqlitepipe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> utility that can be used for this purpose. The following example shows how to use <strong>sqlitepipe</strong> and <a href="https://www.imagemagick.org/" target="_blank" rel="noopener noreferrer">ImageMagick<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to make white pixels transparent on all of the tiles stored within the MBTiles file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$sqlite3</span> my-mbtiles.mbtiles
sqlite<span class="token operator">&gt;</span>UPDATE tiles SET <span class="token assign-left variable">tile_data</span><span class="token operator">=</span>pipe<span class="token punctuation">(</span>tile_data, <span class="token string">'/usr/bin/convert'</span>, <span class="token string">'-transparent'</span>, <span class="token string">'white'</span>, <span class="token string">'png:-'</span>, <span class="token string">'png:-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span>VACUUM tiles<span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span>.quit
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>According the size of the MBTiles to process you may encounter some memory errors and have such an output: <code>Error: database or disk is full</code>
You should tell <strong>sqlite</strong> to use a free disk space to work with the temp files:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>sqlite<span class="token operator">&gt;</span> pragma temp_store <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span> pragma temp_store_directory <span class="token operator">=</span> <span class="token string">'/directory/with/lots/of/space'</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="how-to-create-a-tile-index-from-an-s3-mosaic"><a href="#how-to-create-a-tile-index-from-an-s3-mosaic" class="header-anchor">#</a> How to create a tile index from an S3 mosaic ?</h3> <ol><li>list the tiles in a file while prefixing the tile path with the driver <code>viss3</code></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$aws</span> s3 <span class="token function">ls</span> s3://<span class="token operator">&lt;</span>bucket<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>/ <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^/\/vsis3\/&lt;bucket&gt;\/&lt;path&gt;\//'</span> <span class="token operator">&gt;</span> tiles.txt
</code></pre></div><ol start="2"><li>Create the tile index</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$gdaltindex</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.shp --optfile tiles.txt
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you want to serve the mosaic using <strong>MapServer</strong>, it is recommended to apply the <code>shptree</code> command in order
to optimize the index:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$shptree</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.shp
</code></pre></div><p>In addition you will probably need to provide some parameters, such as <code>wcs_extent</code> and <code>wcs_resolution</code>. You can get them by building a <a href="https://gdal.org/drivers/raster/vrt.html" target="_blank" rel="noopener noreferrer">VRT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$gdalbuildvrt</span> -input_file_list tiles.txt <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.vrt
<span class="token variable">$gdalinfo</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.vrt
</code></pre></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kargo/tips/using-private-registry.html" class="prev">
        Using a private registry
      </a></span> <span class="next"><a href="/kargo/tips/using-artillery.html">
        Using Artillery
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/kargo/assets/js/app.6e8f31dd.js" defer></script><script src="/kargo/assets/js/3.f09f66f6.js" defer></script><script src="/kargo/assets/js/27.810f1a3e.js" defer></script><script src="/kargo/assets/js/4.5c2690c3.js" defer></script>
  </body>
</html>
