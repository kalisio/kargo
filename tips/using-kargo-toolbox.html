<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using the Kargo toolbox | Kargo</title>
    <meta name="description" content="A Docker based solution to deploy Geospatial Services">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kargo/kargo-icon-64x64.png">
  <link rel="manifest" href="/kargo/manifest.json">
    
    <link rel="preload" href="/kargo/assets/css/0.styles.f99ae279.css" as="style"><link rel="preload" href="/kargo/assets/js/app.84928175.js" as="script"><link rel="preload" href="/kargo/assets/js/16.bfcae36b.js" as="script"><link rel="prefetch" href="/kargo/assets/js/10.c2a9a58d.js"><link rel="prefetch" href="/kargo/assets/js/11.e3355f36.js"><link rel="prefetch" href="/kargo/assets/js/12.314ef578.js"><link rel="prefetch" href="/kargo/assets/js/13.72c4c360.js"><link rel="prefetch" href="/kargo/assets/js/14.ddb2b9a4.js"><link rel="prefetch" href="/kargo/assets/js/15.0857ccf7.js"><link rel="prefetch" href="/kargo/assets/js/17.17081604.js"><link rel="prefetch" href="/kargo/assets/js/18.e9e11128.js"><link rel="prefetch" href="/kargo/assets/js/2.31fffd46.js"><link rel="prefetch" href="/kargo/assets/js/3.eb7a14fc.js"><link rel="prefetch" href="/kargo/assets/js/4.b5dad66a.js"><link rel="prefetch" href="/kargo/assets/js/5.a9bd5769.js"><link rel="prefetch" href="/kargo/assets/js/6.5183c9a0.js"><link rel="prefetch" href="/kargo/assets/js/7.b5aff639.js"><link rel="prefetch" href="/kargo/assets/js/8.900a54ca.js"><link rel="prefetch" href="/kargo/assets/js/9.576fa563.js">
    <link rel="stylesheet" href="/kargo/assets/css/0.styles.f99ae279.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kargo/" class="home-link router-link-active"><!----> <span class="site-name">Kargo</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kargo/tips/using-kargo-toolbox.html" class="nav-link router-link-exact-active router-link-active">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kargo/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kargo/guides/understanding-kargo.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kargo/reference/environment.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kargo/tips/using-kargo-toolbox.html" class="nav-link router-link-exact-active router-link-active">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kargo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><a href="/kargo/tips/using-kargo-toolbox.html" class="active sidebar-link">Using the Kargo toolbox</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kargo/tips/using-kargo-toolbox.html#basic-usage" class="sidebar-link">Basic usage</a></li><li class="sidebar-sub-header"><a href="/kargo/tips/using-kargo-toolbox.html#use-cases" class="sidebar-link">Use cases</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kargo/tips/using-kargo-toolbox.html#how-to-post-process-an-mbtiles-file" class="sidebar-link">How to post process an MBTiles file ?</a></li><li class="sidebar-sub-header"><a href="/kargo/tips/using-kargo-toolbox.html#how-to-create-a-tile-index-from-an-s3-mosaic" class="sidebar-link">How to create a tile index from an S3 mosaic ?</a></li></ul></li></ul></li><li><a href="/kargo/tips/handling-long-running-process.html" class="sidebar-link">Handling long-running process</a></li><li><a href="/kargo/tips/using-mongodb-atlas.html" class="sidebar-link">Using MongoDB Atlas</a></li><li><a href="/kargo/tips/extracting-osm-data.html" class="sidebar-link">Extracting OpenStreetMap data ?</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="using-the-kargo-toolbox"><a href="#using-the-kargo-toolbox" aria-hidden="true" class="header-anchor">#</a> Using the Kargo toolbox</h1> <p>The <a href="https://github.com/kalisio/kargo-toolbox" target="_blank" rel="noopener noreferrer">kargo-toolbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a docker image shipping a set of tools to help processing geospatial data. Precisely it comes with:</p> <ul><li><a href="https://www.gdal.org/index.html" target="_blank" rel="noopener noreferrer">GDAL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.imagemagick.org/" target="_blank" rel="noopener noreferrer">ImageMagick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/icetan/sqlitepipe" target="_blank" rel="noopener noreferrer">sqlitepipe<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="basic-usage"><a href="#basic-usage" aria-hidden="true" class="header-anchor">#</a> Basic usage</h2> <p>Simply run the following command on a given worker node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run  -v /path/to/your/data:/data -t -i kalisio/kargo-toolbox:latest /bin/bash
<span class="token variable">$cd</span> /data
<span class="token variable">$gdalinfo</span> path/to/my/dataset
</code></pre></div><p>If you need to access another container you will need to run the GDAL container within the same network. For instance, the following command will allow you to link the GDAL container to an existing <code>Postgis</code> container in the network <code>kargo</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run --network<span class="token operator">=</span>kargo  -v /mnt/data:/data -t -i kalisio/kargo-toolbox:latest /bin/bash
</code></pre></div><p>If you need to use the AWS CLI, you may need to share your credentials:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> run  -v /path/to/your/data:/data /home/ubuntu/.aws:/root/.aws -t -i kalisio/kargo-toolbox:latest /bin/bash
</code></pre></div><h2 id="use-cases"><a href="#use-cases" aria-hidden="true" class="header-anchor">#</a> Use cases</h2> <h3 id="how-to-post-process-an-mbtiles-file"><a href="#how-to-post-process-an-mbtiles-file" aria-hidden="true" class="header-anchor">#</a> How to post process an MBTiles file ?</h3> <p>The <strong>kargo-toolbox</strong> project comes with the <a href="https://github.com/icetan/sqlitepipe" target="_blank" rel="noopener noreferrer">sqlitepipe<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> utility that can be used for this purpose. The following example shows how to use <strong>sqlitepipe</strong> and <a href="https://www.imagemagick.org/" target="_blank" rel="noopener noreferrer">ImageMagick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to make white pixels transparent on all of the tiles stored within the MBTiles file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$sqlite3</span> my-mbtiles.mbtiles
sqlite<span class="token operator">&gt;</span>UPDATE tiles SET tile_data<span class="token operator">=</span>pipe<span class="token punctuation">(</span>tile_data, <span class="token string">'/usr/bin/convert'</span>, <span class="token string">'-transparent'</span>, <span class="token string">'white'</span>, <span class="token string">'png:-'</span>, <span class="token string">'png:-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span>VACUUM tiles<span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span>.quit
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>According the size of the MBTiles to process you may encounter some memory errors and have such an output: <code>Error: database or disk is full</code>
You should tell <strong>sqlite</strong> to use a free disk space to work with the temp files:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>sqlite<span class="token operator">&gt;</span> pragma temp_store <span class="token operator">=</span> 1<span class="token punctuation">;</span>
sqlite<span class="token operator">&gt;</span> pragma temp_store_directory <span class="token operator">=</span> <span class="token string">'/directory/with/lots/of/space'</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="how-to-create-a-tile-index-from-an-s3-mosaic"><a href="#how-to-create-a-tile-index-from-an-s3-mosaic" aria-hidden="true" class="header-anchor">#</a> How to create a tile index from an S3 mosaic ?</h3> <ol><li>list the tiles in a file while prefixing the tile path with the driver <code>viss3</code></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$aws</span> s3 <span class="token function">ls</span> s3://<span class="token operator">&lt;</span>bucket<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>/ <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$4</span>}'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^/\/vsis3\/&lt;bucket&gt;\/&lt;path&gt;\//'</span> <span class="token operator">&gt;</span> tiles.txt
</code></pre></div><ol start="2"><li>Create the tile index</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$gdaltindex</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.shp --optfile tiles.txt
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>If you want to serve the mosaic using <strong>MapServer</strong>, it is recommended to apply the <code>shptree</code> command in order
to optimize the index:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$shptree</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.shp
</code></pre></div><p>In addition you will probably need to provide some parameters, such as <code>wcs_extent</code> and <code>wcs_resolution</code>. You can get them by building a <a href="https://gdal.org/drivers/raster/vrt.html" target="_blank" rel="noopener noreferrer">VRT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$gdalbuildvrt</span> -input_file_list tiles.txt <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.vrt
<span class="token variable">$gdalinfo</span> <span class="token operator">&lt;</span>mosaic<span class="token operator">&gt;</span>.vrt
</code></pre></div></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/kargo/tips/handling-long-running-process.html">
          Handling long-running process
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/kargo/assets/js/app.84928175.js" defer></script><script src="/kargo/assets/js/16.bfcae36b.js" defer></script>
  </body>
</html>
